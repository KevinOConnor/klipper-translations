# Индуктивный датчик вихревых токов

В этом документе описывается использование индуктивного датчика [вихревого тока](https://en.wikipedia.org/wiki/Eddy_current) в Klipper.

В настоящее время вихретоковый датчик не может быть использован для Z-наведения. Датчик можно использовать только для Z-зондирования.

Начните с объявления секции конфигурации [probe_eddy_current](Config_Reference.md#probe_eddy_current) в файле printer.cfg. Рекомендуется установить `z_offset` на 0,5 мм. Обычно для датчика требуется `x_offset` и `y_offset`. Если эти значения неизвестны, их следует оценить при первоначальной калибровке.

Первым шагом в калибровке является определение подходящего DRIVE_CURRENT для датчика. Включите принтер и установите инструментальную головку так, чтобы датчик находился около центра станины и был примерно на 20 мм выше нее. Затем выполните команду `LDC_CALIBRATE_DRIVE_CURRENT CHIP=<имя_конфигурации>`. Например, если раздел конфигурации был назван `[probe_eddy_current my_eddy_probe]`, то следует выполнить команду `LDC_CALIBRATE_DRIVE_CURRENT CHIP=my_eddy_probe`. Эта команда должна завершиться через несколько секунд. После ее выполнения выполните команду `SAVE_CONFIG`, чтобы сохранить результаты в файле printer.cfg, и перезагрузитесь.

Второй шаг калибровки - соотнесение показаний датчиков с соответствующими высотами Z. Включите принтер и установите головку инструмента так, чтобы сопло находилось около центра станины. Затем выполните команду `PROBE_EDDY_CURRENT_CALIBRATE CHIP=my_eddy_probe`. После запуска инструмента выполните действия, описанные в разделе ["Тест на бумаге"](Bed_Level.md#the-paper-test), чтобы определить фактическое расстояние между соплом и станиной в заданном месте. После выполнения этих шагов можно `принять` положение. Затем инструмент переместит инструментальную головку так, чтобы датчик находился над точкой, где раньше находилась насадка, и выполнит серию движений, чтобы соотнести положение датчика с положением Z. Это займет пару минут. После завершения работы инструмента выполните команду `SAVE_CONFIG`, чтобы сохранить результаты в файле printer.cfg, и перезагрузитесь.

После первоначальной калибровки рекомендуется проверить точность значений `x_offset` и `y_offset`. Выполните шаги по [калибровке смещений x и y зонда](Probe_Calibrate.md#calibrating-probe-x-and-y-offsets). Если изменяется `x_offset` или `y_offset`, то после внесения изменений обязательно выполните команду `PROBE_EDDY_CURRENT_CALIBRATE` (как описано выше).

После завершения калибровки можно использовать все стандартные инструменты Klipper, в которых применяется Z-зонд.

Обратите внимание, что вихретоковые датчики (и индуктивные датчики в целом) подвержены "тепловому дрейфу". То есть изменение температуры может привести к изменению регистрируемой высоты Z. Изменения температуры поверхности ложа или аппаратной температуры датчика могут исказить результаты. Важно, чтобы калибровка и измерение проводились только при стабильной температуре принтера.

## Калибровка теплового отвода

Как и все индуктивные датчики, вихретоковые датчики подвержены значительному тепловому дрейфу. Если вихретоковый датчик имеет температурный датчик на катушке, можно сконфигурировать раздел `[temperature_probe]` для сообщения о температуре катушки и включения программной компенсации дрейфа. Чтобы связать температурный датчик с вихретоковым датчиком, секция `[temperature_probe]` должна иметь общее имя с секцией `[probe_eddy_current]`. Например:

```
[probe_eddy_current my_probe]

# конфигурация вихревого зонда...

[temperature_probe my_probe]

# конфигурация температурного зонда...
```

Дополнительные сведения о том, как настроить `temperature_probe`, см. в [справочнике конфигурации](Config_Reference.md#temperature_probe). Рекомендуется настроить опции `calibration_position`, `calibration_extruder_temp`, `extruder_heating_z` и `calibration_bed_temp`, поскольку это позволит автоматизировать некоторые шаги, описанные ниже.

Производители вихревых датчиков могут предлагать стандартную калибровку дрейфа, которую можно вручную добавить в опцию `drift_calibration` секции `[probe_eddy_current]`. Если они этого не делают, или если стандартная калибровка не дает хороших результатов в вашей системе, модуль `temperature_probe` предлагает процедуру ручной калибровки с помощью gcode-команды `TEMPERATURE_PROBE_CALIBRATE`.

Перед выполнением калибровки пользователь должен иметь представление о максимально достижимой температуре катушки температурного зонда. Эта температура должна использоваться для установки параметра `TARGET` команды `TEMPERATURE_PROBE_CALIBRATE`. Целью является калибровка в максимально широком диапазоне температур, поэтому желательно начинать калибровку с холодного принтера и заканчивать с катушкой при максимальной температуре, которую она может достичь.

После настройки `[temperature_probe]` можно выполнить следующие шаги для калибровки теплового дрейфа:

- Датчик должен быть откалиброван с помощью `PROBE_EDDY_CURRENT_CALIBRATE`, когда настроен и связан `[temperature_probe]`. При этом фиксируется температура во время калибровки, что необходимо для компенсации теплового дрейфа.
- Убедитесь, что в сопле нет мусора и нити.
- Перед калибровкой станина, сопло и катушка зонда должны быть холодными.
- Следующие шаги необходимы, если опции `calibration_position`, `calibration_extruder_temp` и `extruder_heating_z` в `[temperature_probe]` не настроены **НЕТ**:
   - Переместите инструмент в центр станины. Z должна быть на 30 мм выше станины.
   - Нагрейте экструдер до температуры, превышающей максимальную безопасную температуру слоя. Для большинства конфигураций достаточно 150-170C. Цель нагрева экструдера - избежать расширения сопла во время калибровки.
   - Когда температура экструдера установится, переместите ось Z вниз на высоту около 1 мм над станиной.
- Запустите калибровку дрейфа. Если имя зонда `my_probe` и максимальная температура зонда, которую мы можем достичь, равна 80C, то соответствующая команда gcode будет `TEMPERATURE_PROBE_CALIBRATE PROBE=my_probe TARGET=80`. Если инструмент настроен, он переместится в координаты X,Y, указанные в `calibration_position`, и в значение Z, указанное в `extruder_heating_z`. После нагрева экструдера до заданной температуры инструмент переместится к значению Z, указанному в `calibration_position`.
- Процедура запросит ручной тест. Выполните ручной зонд с бумажным тестом и `ПРИНЯТЬ`. Процедура калибровки возьмет первый набор проб с помощью зонда, а затем припаркует зонд в положении нагрева.
- Если параметр `calibration_bed_temp` **НЕ** настроен, включите подогрев кровати до максимальной безопасной температуры. В противном случае этот шаг будет выполнен автоматически.
- По умолчанию процедура калибровки будет запрашивать ручной зонд каждые 2C между образцами, пока не будет достигнуто значение `TARGET`. Дельта температур между пробами может быть настроена путем установки параметра `STEP` в `TEMPERATURE_PROBE_CALIBRATE`. Следует быть осторожным при установке пользовательского значения `STEP`, слишком высокое значение может запросить слишком мало образцов, что приведет к плохой калибровке.
- Во время калибровки дрейфа доступны следующие дополнительные команды gcode:
   - `TEMPERATURE_PROBE_NEXT` может использоваться для принудительного взятия нового образца до достижения дельты шага.
   - `TEMPERATURE_PROBE_COMPLETE` может использоваться для завершения калибровки до достижения `TARGET`.
   - Для завершения калибровки и отмены результатов можно использовать команду `ABORT`.
- По окончании калибровки используйте `SAVE_CONFIG` для сохранения калибровки дрейфа.

Как можно заключить, описанный выше процесс калибровки является более сложным и трудоемким, чем большинство других процедур. Для достижения оптимальной калибровки может потребоваться практика и несколько попыток.
