# Часто задаваемые вопросы

## Как я могу пожертвовать проекту?

Благодарим вас за поддержку. Информацию смотрите на странице [Спонсоры](Sponsors.md).

## Как мне рассчитать конфигурационный параметр rotation_distance?

Посмотрите на [rotation distance document](Rotation_Distance.md).

## Где мой последовательный порт?

Общий способ найти последовательный порт USB — запустить `ls /dev/serial/by-id/*` из терминала ssh на хост-компьютере. Скорее всего, это приведет к выводу, похожему на следующее:

```
/dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
```

Имя, определённое в приведенной выше команде, является стабильным, и его можно использовать в файле конфигурации и при прошивке кода микроконтроллера. Например, команда «flash» может выглядеть примерно так:

```
sudo service klipper stop
make flash FLASH_DEVICE=/dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
sudo service klipper start
```

и обновлённая конфигурация может выглядеть так:

```
[mcu]
serial: /dev/serial/by-id/usb-1a86_USB2.0-Serial-if00-port0
```

Обязательно скопируйте и вставьте имя из команды «ls», которую вы запустили выше, так как имя будет разным для каждого принтера.

Если вы используете несколько микроконтроллеров, которые не имеют уникальных идентификаторов (распространены на чипах CH340 USB) тогда следуйте инструкциям выше, используя команду `ls /dev/serial/by-path/*` вместо этого.

## Когда микроконтроллер перезапускает устройство, изменения в/dev/ttyUSB1

Следуйте указаниям из секции "[Где мой последовательный порт?](#где-мой-последовательный-порт)" чтобы предотвратить это.

## Команда "прошить" не работает

Код пытается прошить устройство с помощью самого распространенного способа. К сожалению, существует множество способов прошивки, потому команда "прошить" может не работать на всех возможных приборах.

Если у вас периодические сбои или стандартная настройка, проверьте, не запущен ли Klipper при прошивке (sudo service klipper stop), убедитесь, что OctoPrint не пытается подключиться к устройству напрямую (откройте вкладку Соединение на веб-странице и нажмите Отключить, если для устройства установлен Последовательный порт), и убедитесь, что FLASH_DEVICE установлен правильно для вашей платы (см. [вопрос выше](#wheres-my-serial-port)).

Однако если "make flash" просто не работает для вашей платы, то вам придется прошивать вручную. Проверьте, есть ли в каталоге [config](../config) файл конфигурации с конкретными инструкциями по прошивке устройства. Также проверьте документацию производителя платы, чтобы узнать, описано ли в ней, как прошить устройство. Наконец, можно прошить устройство вручную с помощью таких инструментов, как "avrdude" или "bossac" - дополнительную информацию см. в документе [ bootloader document](Bootloaders.md)].

## Как я могу изменить скорость порта?

Рекомендуемая скорость передачи данных для Klipper - 250000. Эта скорость передачи данных хорошо работает на всех платах микроконтроллеров, которые поддерживает Klipper. Если вы нашли в Интернете руководство, рекомендующее другую скорость передачи данных, проигнорируйте эту часть руководства и продолжайте использовать значение по умолчанию 250000.

Если вы все равно хотите изменить скорость передачи данных, то новую скорость нужно будет настроить в микроконтроллере (во время **make menuconfig**), а обновленный код нужно будет скомпилировать и прошить в микроконтроллер. Файл Klipper printer.cfg также нужно будет обновить, чтобы он соответствовал этой скорости передачи данных (подробности см. в [ссылка на конфигурацию ](Config_Reference.md#mcu). Например:

```
[mcu]
бод: 250000
```

Скорость передачи данных, указанная на веб-странице OctoPrint, не влияет на скорость передачи данных внутреннего микроконтроллера Klipper. При использовании Klipper всегда устанавливайте скорость передачи данных OctoPrint на 250000.

Скорость передачи данных микроконтроллера Klipper не связана со скоростью передачи данных загрузчика микроконтроллера. Дополнительную информацию о загрузчиках смотрите в документе [bootloader](Bootloaders.md).

## Можно ли запустить Klipper на чем-то другом, кроме Raspberry Pi 3?

Рекомендуемое оборудование - Raspberry Pi 2, Raspberry Pi 3 или Raspberry Pi 4.

Klipper будет работать на Raspberry Pi 1 и на Raspberry Pi Zero, но эти платы не обладают достаточной вычислительной мощностью для работы OctoPrint. На этих медленных машинах часто возникают задержки печати при печати непосредственно из OctoPrint. (Принтер может двигаться быстрее, чем OctoPrint может посылать команды перемещения). Если вы хотите работать на одной из этих медленных плат, рассмотрите возможность использования функции "virtual_sdcard" при печати (подробности смотрите в [ссылка на конфигурацию](Config_Reference.md#virtual_sdcard)).

Для запуска на Beaglebone см. инструкцию по установке [Beaglebone specific installation instructions](Beaglebone.md).

Klipper уже запускался на других машинах. Для работы хост-программы Klipper требуется только Python, запущенный на компьютере с ОС Linux (или аналогичной). Однако если вы хотите запустить его на другой машине, вам понадобятся знания администратора Linux, чтобы установить системные предпосылки для этой машины. Дополнительную информацию о необходимых действиях администратора Linux см. в сценарии [install-octopi.sh](../scripts/install-octopi.sh).

Если вы хотите запустить хост-программу Klipper на низкоуровневом чипе, то имейте в виду, что, как минимум, требуется машина с аппаратным обеспечением "двойной точности с плавающей точкой".

Если вы хотите запустить хост-программу Klipper на общей настольной или серверной машине общего назначения, обратите внимание, что Klipper предъявляет определенные требования к расписанию в реальном времени. Если во время печати хост-компьютер также выполняет интенсивную вычислительную задачу общего назначения (например, дефрагментацию жесткого диска, 3d-рендеринг, интенсивный свопинг и т. д.), то это может привести к тому, что Klipper будет сообщать об ошибках печати.

Примечание: Если вы не используете образ OctoPi, имейте в виду, что некоторые дистрибутивы Linux включают пакет "ModemManager" (или аналогичный), который может нарушить последовательную связь. (Это может привести к тому, что Klipper будет выдавать случайные ошибки "Потеряна связь с MCU"). Если вы устанавливаете Klipper на один из таких дистрибутивов, вам может потребоваться отключить этот пакет.

## Можно ли запустить несколько экземпляров Klipper на одном хост-машине?

Можно запустить несколько экземпляров хост-программы Klipper, но для этого требуются знания администратора Linux. Сценарии установки Klipper в конечном итоге вызывают выполнение следующей команды Unix:

```
~/klippy-env/bin/python ~/klipper/klippy/klippy.py ~/printer.cfg -l /tmp/klippy.log
```

Можно запустить несколько экземпляров вышеуказанной команды, если у каждого экземпляра есть свой файл конфигурации принтера, свой файл журнала и своя псевдо-тишина. Например:

```
~/klippy-env/bin/python ~/klipper/klippy/klippy.py ~/printer2.cfg -l /tmp/klippy2.log -I /tmp/printer2
```

Если вы решите сделать это, вам нужно будет реализовать необходимые скрипты запуска, остановки и установки (если таковые имеются). В качестве примера можно привести скрипт [install-octopi.sh](../scripts/install-octopi.sh) и скрипт [klipper-start.sh](../scripts/klipper-start.sh).

## Обязательно ли использовать OctoPrint?

Программное обеспечение Klipper не зависит от OctoPrint. Можно использовать альтернативное программное обеспечение для отправки команд в Klipper, но это требует знаний администратора Linux.

Klipper создает "виртуальный последовательный порт" через файл "/tmp/printer" и эмулирует классический последовательный интерфейс 3d-принтера через этот файл. В общем, альтернативное программное обеспечение может работать с Klipper, если оно может быть настроено на использование "/tmp/printer" для последовательного порта принтера.

## Почему я не могу перемещать шаговый механизм перед наведением принтера?

Это делается для того, чтобы уменьшить вероятность случайного попадания головки в кровать или стену. После наведения принтера программа пытается проверить, что каждое перемещение находится в пределах position_min/max, заданных в файле конфигурации. Если двигатели отключены (командой M84 или M18), то перед перемещением их нужно будет снова навести.

Если вы хотите перемещать головку после отмены печати через OctoPrint, измените последовательность отмены OctoPrint, чтобы она делала это за вас. Она настраивается в OctoPrint через веб-браузер в разделе: Настройки->Сценарии GCODE

Если вы хотите перемещать головку после завершения печати, добавьте нужное движение в раздел "пользовательский g-код" вашего слайсера.

Если принтер требует дополнительного перемещения в рамках процесса самонаведения (или в принципе не имеет процесса самонаведения), рассмотрите возможность использования секции safe_z_home или homing_override в файле конфигурации. Если вам необходимо перемещать шаговый механизм в целях диагностики или отладки, подумайте о добавлении секции force_move в файл конфигурации. Дополнительные сведения об этих опциях смотрите в [ ссылка на конфигурацию ](Config_Reference.md#customized_homing).

## Почему в конфигурации по умолчанию для параметра Z position_endstop установлено значение 0,5?

Для принтеров картезианского типа параметр Z position_endstop указывает, на каком расстоянии от станины находится сопло в момент срабатывания концевого упора. По возможности рекомендуется использовать концевой упор Z-max и размещать сопло вдали от станины (так как это снижает вероятность столкновений со станиной). Однако если необходимо направить ось к станине, рекомендуется установить концевой упор таким образом, чтобы он срабатывал, когда сопло находится на небольшом расстоянии от станины. Таким образом, при наведении оси она остановится до того, как сопло коснется станины. Дополнительные сведения см. в документе [Уровень станины](Bed_Level.md).

## Я преобразовал свою конфигурацию из Marlin, и оси X/Y работают нормально, но при наведении на ось Z появляется визжащий шум

Краткий ответ: Во-первых, убедитесь, что вы проверили конфигурацию степпера, как описано в документе [ config check document ](Config_checks.md). Если проблема сохраняется, попробуйте уменьшить параметр max_z_velocity в конфигурации принтера.

Длинный ответ: На практике Marlin обычно может шагать со скоростью около 10000 шагов в секунду. Если его попросят двигаться со скоростью, требующей большей частоты шагов, то Marlin, как правило, будет шагать настолько быстро, насколько сможет. Klipper способен достичь гораздо более высокой частоты шагов, но шаговый двигатель может не иметь достаточного крутящего момента для движения на более высокой скорости. Таким образом, для оси Z с высоким передаточным отношением или высокими настройками микрошагов фактическая достижимая скорость max_z_velocity может быть меньше, чем настроенная в Marlin.

## Драйвер двигателя TMC выключается в середине печати

Если вы используете драйвер TMC2208 (или TMC2224) в "автономном режиме", убедитесь, что вы используете [последнюю версию Klipper](#how-do-i-upgrade-to-the-latest-software). В середине марта 2020 года в Klipper было добавлено обходное решение проблемы "stealthchop" драйвера TMC2208.

## Я продолжаю получать случайные ошибки "Потеряна связь с MCU"

Обычно это вызвано аппаратными ошибками в USB-соединении между хост-машиной и микроконтроллером. На что обратить внимание:

- Используйте качественный USB-кабель между хост-машиной и микроконтроллером. Убедитесь, что штекеры надежно закреплены.
- Если вы используете Raspberry Pi, используйте [качественный блок питания](https://www.raspberrypi.com/documentation/computers/raspberry-pi.html#power-supply) для Raspberry Pi и [качественный USB-кабель](https://forums.raspberrypi.com/viewtopic.php?p=589877#p589877) для подключения этого блока питания к Pi. Если OctoPrint выдает предупреждение "пониженное напряжение", это связано с блоком питания и должно быть исправлено.
- Убедитесь, что источник питания принтера не перегружен. (Перепады напряжения на USB-чипе микроконтроллера могут привести к его перезагрузке)
- Убедитесь, что провода шагового двигателя, нагревателя и другие провода принтера не пережаты и не перетерты. (Движение принтера может создавать нагрузку на неисправный провод, что приведет к потере контакта, кратковременному замыканию или возникновению чрезмерного шума)
- Поступали сообщения о высоком уровне шума USB при смешанном питании принтера и 5 В хоста. (Если вы обнаружите, что микроконтроллер включается, когда включен источник питания принтера или подключен кабель USB, это означает, что источники питания 5 В смешиваются). Возможно, поможет настройка микроконтроллера на использование питания только от одного источника. (В качестве альтернативы, если плата микроконтроллера не может настроить источник питания, можно модифицировать USB-кабель таким образом, чтобы он не передавал 5 В между хостом и микроконтроллером)

## Мой Raspberry Pi постоянно перезагружается во время печати

Скорее всего, это связано с перепадами напряжения. Выполните те же шаги по устранению ошибки ["Потеряна связь с MCU"] (#i-keep-getting-random-lost-communication-with-mcu-errors).

## Когда я устанавливаю `restart_method=command`, мое устройство AVR просто зависает при перезапуске

В некоторых старых версиях загрузчика AVR известна ошибка в обработке событий сторожевого таймера. Обычно это проявляется, когда в файле printer.cfg для параметра restart_method установлено значение "command". При возникновении ошибки устройство AVR не реагирует на запросы до тех пор, пока не будет снято и снова подано питание (светодиоды питания или состояния также могут неоднократно мигать до тех пор, пока питание не будет снято).

Обходным решением является использование метода restart_method, отличного от "command", или прошивка обновленного загрузчика в устройство AVR. Прошивка нового загрузчика - это одноразовый шаг, для которого обычно требуется внешний программатор - более подробную информацию см. в [Bootloaders](Bootloaders.md).

## Останутся ли обогреватели включенными, если Raspberry Pi сломается?

Программное обеспечение разработано таким образом, чтобы предотвратить это. Как только хост включает нагреватель, программное обеспечение хоста должно подтверждать это включение каждые 5 секунд. Если микроконтроллер не получает подтверждения каждые 5 секунд, он переходит в состояние "выключения", которое предназначено для отключения всех нагревателей и шаговых двигателей.

Дополнительные сведения смотрите в команде "config_digital_out" в документе [MCU commands](MCU_Commands.md).

Кроме того, при запуске программное обеспечение микроконтроллера настраивается на минимальный и максимальный температурный диапазон для каждого нагревателя (подробнее см. параметры min_temp и max_temp в [config reference](Config_Reference.md#extruder)). Если микроконтроллер обнаружит, что температура выходит за пределы этого диапазона, он также перейдет в состояние "отключения".

Отдельно в хост-программе реализован код для проверки правильности работы нагревателей и датчиков температуры. Дополнительные сведения см. в [ссылка на конфигурацию](Config_Reference.md#verify_heater).

## Как преобразовать номер пина Marlin в имя пина Klipper?

Короткий ответ: Сопоставление доступно в файле [sample-aliases.cfg](../config/sample-aliases.cfg). Используйте этот файл как руководство для поиска реальных имен выводов микроконтроллера. (Можно также скопировать соответствующий раздел конфигурации [board_pins](Config_Reference.md#board_pins) в свой файл конфигурации и использовать псевдонимы в конфигурации, но предпочтительнее перевести и использовать реальные имена выводов микроконтроллера). Обратите внимание, что в файле sample-aliases.cfg используются имена выводов, начинающиеся с префикса "ar" вместо "D" (например, вывод Arduino `D23` - это Klipper-алиас `ar23`) и префикса "analog" вместо "A" (например, вывод Arduino `A14` - это Klipper-алиас `analog14`).

Длинный ответ: Klipper использует стандартные имена выводов, определяемые микроконтроллером. В чипах Atmega эти аппаратные пины имеют такие названия, как `PA4`, `PC7` или `PD2`.

Давным-давно проект Arduino решил отказаться от использования стандартных аппаратных названий в пользу собственных названий выводов, основанных на возрастающих числах - эти названия Arduino обычно выглядят как `D23` или `A14`. Это был неудачный выбор, который привел к большой путанице. В частности, номера выводов Arduino часто не совпадают с названиями аппаратуры. Например, `D21` - это `PD0` на одной распространенной плате Arduino, но `PC7` на другой распространенной плате Arduino.

Чтобы избежать этой путаницы, основной код Klipper использует стандартные имена выводов, определенные микроконтроллером.

## Нужно ли подключать устройство к определенному типу выводов микроконтроллера?

Это зависит от типа устройства и типа пина:

Штырьки АЦП (или аналоговые штырьки): Для термисторов и подобных "аналоговых" датчиков устройство должно быть подключено к "аналоговому" или "АЦП" выводу микроконтроллера. Если вы настроите Klipper на использование вывода, который не поддерживает аналоговый режим, Klipper выдаст ошибку "Not a valid ADC pin".

ШИМ-контакты (или контакты таймера): Klipper не использует аппаратный ШИМ по умолчанию для любого устройства. Поэтому, в общем случае, можно подключать нагреватели, вентиляторы и подобные устройства к любому выводу IO общего назначения. Однако вентиляторы и устройства output_pin могут быть опционально настроены на использование `hardware_pwm: True`, в этом случае микроконтроллер должен поддерживать аппаратную ШИМ на выводе (иначе Klipper выдаст ошибку "Not a valid PWM pin").

Штырьки IRQ (или штырьки прерываний): Klipper не использует аппаратные прерывания на выводах ввода-вывода, поэтому никогда не нужно подключать устройство к одному из этих выводов микроконтроллера.

Штырьки SPI: При использовании аппаратного SPI необходимо подключить контакты к выводам микроконтроллера, поддерживающим SPI. Однако большинство устройств можно настроить на использование "программного SPI", и в этом случае можно использовать любые выводы ввода-вывода общего назначения.

Штырьки I2C: При использовании I2C необходимо подключить контакты к выводам микроконтроллера, поддерживающим I2C.

Другие устройства могут быть подключены к любому выводу IO общего назначения. Например, шаговики, нагреватели, вентиляторы, Z-зонды, сервоприводы, светодиоды, обычные ЖК-дисплеи hd44780/st7920, линия управления Trinamic UART может быть подключена к любому выводу IO общего назначения.

## Как отменить запрос M109/M190 "ожидание температуры"?

Перейдите на вкладку терминала OctoPrint и выполните команду M112 в окне терминала. Команда M112 приведет к тому, что Klipper перейдет в состояние "выключения", и OctoPrint отключится от Klipper. Перейдите в область подключения OctoPrint и нажмите на кнопку "Подключить", чтобы OctoPrint снова подключился. Вернитесь на вкладку терминала и выполните команду FIRMWARE_RESTART, чтобы очистить состояние ошибки Klipper. После выполнения этой последовательности предыдущий запрос на нагрев будет отменен, и можно будет начать новую печать.

## Можно ли узнать, не сбился ли принтер с шага?

В некотором смысле, да. Верните принтер домой, выполните команду `GET_POSITION`, запустите печать, снова вернитесь домой и выполните еще одну команду `GET_POSITION`. Затем сравните значения в строке `mcu:`.

Это может быть полезно для настройки таких параметров, как токи, ускорения и скорости шаговых двигателей, без необходимости печатать что-то и тратить нить: просто выполните несколько высокоскоростных движений между командами `GET_POSITION`.

Обратите внимание, что сами концевые выключатели имеют тенденцию срабатывать в немного разных положениях, поэтому разница в пару микрошагов, скорее всего, является результатом неточности концевого выключателя. Сам шаговый двигатель может терять шаги только с шагом в 4 полных шага. (Таким образом, если используется 16 микрошагов, то потеря шага на шаговом двигателе приведет к тому, что счетчик шагов "mcu:" будет смещен на величину, кратную 64 микрошагам)

## Почему Klipper сообщает об ошибках? Я потерял печать!

Короткий ответ: Мы хотим знать, обнаруживают ли наши принтеры проблему, чтобы можно было устранить основную проблему и получить отпечатки отличного качества. Мы определенно не хотим, чтобы наши принтеры беззвучно выдавали отпечатки низкого качества.

Длинный ответ: Klipper был спроектирован таким образом, чтобы автоматически обходить многие переходные проблемы. Например, он автоматически обнаруживает ошибки связи и осуществляет повторную передачу; он заранее планирует действия и буферизует команды на нескольких уровнях, чтобы обеспечить точную синхронизацию даже в условиях периодических помех. Однако если программа обнаружит ошибку, от которой она не может оправиться, если ей будет приказано выполнить недопустимое действие или если она обнаружит, что безнадежно не в состоянии выполнить поставленную задачу, Klipper сообщит об ошибке. В таких ситуациях высок риск получения некачественного отпечатка (или даже хуже). Мы надеемся, что предупреждение пользователя позволит ему устранить основную проблему и повысить общее качество отпечатков.

Есть несколько сопутствующих вопросов: Почему Klipper не приостанавливает печать? Не выдает предупреждение? Проверить наличие ошибок перед печатью? Игнорировать ошибки в набранных пользователем командах и т. д.? В настоящее время Klipper считывает команды по протоколу G-Code, и, к сожалению, протокол команд G-Code недостаточно гибок, чтобы сделать эти альтернативы практичными на сегодняшний день. Разработчики заинтересованы в улучшении пользовательского опыта во время аномальных событий, но ожидается, что это потребует значительной работы над инфраструктурой (включая отказ от G-Code).

## Как обновить программное обеспечение до последней версии?

Первым шагом к обновлению программного обеспечения является просмотр последнего документа [config changes](Config_Changes.md). Иногда в программное обеспечение вносятся изменения, требующие от пользователей обновления настроек в рамках обновления программного обеспечения. Нелишним будет ознакомиться с этим документом перед обновлением.

Когда вы будете готовы к обновлению, как правило, нужно войти в Raspberry Pi по ssh и запустить программу:

```
cd ~/klipper
git pull
~/klipper/scripts/install-octopi.sh
```

Затем можно перекомпилировать и прошить код микроконтроллера. Например:

```
make menuconfig
make clean
make

sudo service klipper stop
make flash FLASH_DEVICE=/dev/ttyACM0
sudo service klipper start
```

Однако часто бывает так, что меняется только программное обеспечение хоста. В этом случае можно обновить и перезапустить только хост-программу:

```
cd ~/klipper
git pull
sudo service klipper restart
```

Если после использования этого ярлыка программа выдаст предупреждение о необходимости перепрошивки микроконтроллера или возникнет другая необычная ошибка, выполните все шаги по обновлению, описанные выше.

Если ошибки сохраняются, проверьте документ [config changes](Config_Changes.md), так как вам может потребоваться изменить конфигурацию принтера.

Обратите внимание, что команды g-кода RESTART и FIRMWARE_RESTART не загружают новое программное обеспечение - для того чтобы изменения в программном обеспечении вступили в силу, необходимо выполнить вышеуказанные команды "sudo service klipper restart" и "make flash".

## Как удалить Klipper?

Для прошивки ничего особенного делать не нужно. Просто следуйте инструкциям по прошивке новой прошивки.

На стороне raspberry pi сценарий удаления доступен в [scripts/klipper-uninstall.sh](../scripts/klipper-uninstall.sh). Например:

```
sudo ~/klipper/scripts/klipper-uninstall.sh
rm -rf ~/klippy-env ~/klipper
```
