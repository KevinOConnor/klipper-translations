# கான்பச் நெறிமுறை

[கேன் பச்] (https://en.wikipedia.org/wiki/can_bus) தொடர்புகொள்வதற்கு கிளிப்பர் பயன்படுத்தும் நெறிமுறையை இந்த ஆவணம் விவரிக்கிறது. கேன் பச் மூலம் கிளிப்பரை உள்ளமைப்பது குறித்த தகவலுக்கு <canbus.md> ஐப் பார்க்கவும்.

## மைக்ரோ-கண்ட்ரோலர் ஐடி ஒதுக்கீடு

கிளிப்பர் கேன் 2.0 ஏ நிலையான அளவு கேன் பச் பாக்கெட்டுகளை மட்டுமே பயன்படுத்துகிறது, அவை 8 தரவு பைட்டுகளுக்கு மட்டுப்படுத்தப்பட்டவை மற்றும் 11-பிட் கேன் பச் அடையாளங்காட்டியை மட்டுமே பயன்படுத்துகின்றன. திறமையான தகவல்தொடர்புகளை ஆதரிப்பதற்காக, ஒவ்வொரு மைக்ரோ-கண்ட்ரோலரும் ரன்-பைட் ஒரு தனித்துவமான 1-பைட் கேன் பச் நோடிட் (`கான்பச்_நோடிட்`) பொது கிளிப்பர் கட்டளை மற்றும் மறுமொழி போக்குவரத்துக்கு ஒதுக்கப்படுகிறது. ஓச்டிலிருந்து மைக்ரோ-கன்ட்ரோலருக்கு செல்லும் கிளிப்பர் கட்டளை செய்திகள் `Canbus_nodeid * 2 + 256` இன் கேன் பச் ஐடியைப் பயன்படுத்துகின்றன, அதே நேரத்தில் மைக்ரோ-கன்ட்ரோலரிடமிருந்து கிளிப்பர் மறுமொழி செய்திகள்` Canbus_nodeid * 2 + 256 + 1` ஐப் பயன்படுத்துகின்றன.

ஒவ்வொரு மைக்ரோ-கன்ட்ரோலருக்கும் ஒரு தொழிற்சாலை ஒதுக்கப்பட்ட தனித்துவமான சிப் அடையாளங்காட்டி உள்ளது, இது ஐடி ஒதுக்கீட்டின் போது பயன்படுத்தப்படுகிறது. இந்த அடையாளங்காட்டி ஒரு பாக்கெட்டின் நீளத்தை விட அதிகமாக இருக்கலாம், எனவே தொழிற்சாலை ஐடியிலிருந்து தனித்துவமான 6-பைட் ஐடியை (`கான்பச்_யூயிட்`) உருவாக்க ஒரு ஆச் செயல்பாடு பயன்படுத்தப்படுகிறது.

## நிர்வாக செய்திகள்

நிர்வாக செய்திகள் ஐடி ஒதுக்கீட்டிற்கு பயன்படுத்தப்படுகின்றன. ஓச்டிலிருந்து மைக்ரோ-கன்ட்ரோலருக்கு அனுப்பப்பட்ட நிர்வாகச் செய்திகள் கேன் பச் ஐடி `0x3f00` மற்றும் மைக்ரோ-கன்ட்ரோலரிடமிருந்து அனுப்பப்பட்ட செய்திகளை புரவலன் செய்ய கேன் பச் ஐடி` 0x3f1` ஐப் பயன்படுத்தவும். அனைத்து மைக்ரோ-கன்ட்ரோலர்களும் ஐடி `0x3f00` இல் செய்திகளைக் கேட்கிறார்கள்; அந்த ஐடியை "ஒளிபரப்பு முகவரி" என்று கருதலாம்.

### சிஎம்டி வினவல் ஒதுக்கப்படாத செய்தி

இந்த கட்டளை இதுவரை ஒதுக்கப்படாத அனைத்து மைக்ரோ-கன்ட்ரோலர்களையும் வினவுகிறது. ஒதுக்கப்படாத மைக்ரோ-கன்ட்ரோலர்கள் ஒரு RESP_NEED_NODEID மறுமொழி செய்தியுடன் பதிலளிக்கும்.

CMD_QUERY_UNASSIGNED செய்தி வடிவம்: `<1-பைட் செய்தி_ஐடி = 0x00>`

### CMD_SET_KLIPPER_NODEID செய்தி

இந்த கட்டளை கொடுக்கப்பட்ட `Canbus_uuuid` உடன் மைக்ரோ-கன்ட்ரோலருக்கு` Canbus_nodeid` ஐ ஒதுக்குகிறது.

CMD_SET_KLIPPER_NODEID செய்தி வடிவம்: `<1-பைட் செய்தி_ஐடி = 0x01> <6-பைட் கான்பச்_யூயிட்> <1-பைட் கான்பச்_நோடிட்>`

### RESP_NEED_NODEID செய்தி

Resp_need_nodeid செய்தி வடிவம்: `<1-பைட் செய்தி_ஐடி = 0x20> <6-பைட் கான்பச்_யூயிட்> <1-பைட் செட்_க்லிப்பர்_நோடிட் = 0x01>`

## தரவு பாக்கெட்டுகள்

CMD_SET_KLIPPER_NODEID கட்டளை வழியாக ஒரு நோடிட் ஒதுக்கப்பட்ட மைக்ரோ-கட்டுப்பாட்டாளர் தரவு பாக்கெட்டுகளை அனுப்பலாம் மற்றும் பெறலாம்.

முனை பெறும் கேன் பச் ஐடி (`Canbus_nodeid * 2 + 256`) ஒரு இடையகத்துடன் சேர்க்கப்படுகிறது, மேலும் ஒரு முழுமையான [MCU நெறிமுறை செய்தி] (நெறிமுறை. . தரவு ஒரு பைட் ச்ட்ரீம் என்று கருதப்படுகிறது - கேன் பச் பாக்கெட்டின் தொடக்கத்துடன் சீரமைக்க ஒரு கிளிப்பர் செய்தி தொகுதியைத் தொடங்க வேண்டிய அவசியமில்லை.

இதேபோல், எம்.சி.யு நெறிமுறை செய்தி பதில்கள் மைக்ரோ-கன்ட்ரோலரிலிருந்து ஓச்டுக்கு அனுப்பப்படுகின்றன.
