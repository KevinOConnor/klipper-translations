# RPI மைக்ரோகண்ட்ரோலர்

இந்த ஆவணம் ஒரு RPI இல் கிளிப்பரை இயக்கும் செயல்முறையை விவரிக்கிறது மற்றும் அதே RPI ஐ இரண்டாம் நிலை MCU ஐப் பயன்படுத்துகிறது.

## இரண்டாம் நிலை MCU ஆக RPI ஐ ஏன் பயன்படுத்த வேண்டும்?

முக்கிய அச்சிடும் செயல்பாடுகளை (வெப்ப மின்தடையங்கள், எக்ச்ட்ரூடர்கள், ச்டெப்பர்கள் ...) நிர்வகிக்க 3D அச்சுப்பொறிகளைக் கட்டுப்படுத்த அர்ப்பணிக்கப்பட்ட MCU கள் ஒரு வரையறுக்கப்பட்ட மற்றும் முன் கட்டமைக்கப்பட்ட ஊசிகளின் எண்ணிக்கையைக் கொண்டுள்ளன. இரண்டாம் நிலை எம்.சி.யுவாக கிளிப்பர் நிறுவப்பட்டுள்ள ஆர்.பி.ஐ.யைப் பயன்படுத்துவது, ஆக்டோப்ரிண்ட் செருகுநிரல்கள் (பயன்படுத்தப்பட்டால்) அல்லது வெளிப்புற நிரல்களைப் பயன்படுத்தாமல் கிளிப்பருக்குள் உள்ள ஆர்.பி.ஐ. அச்சு gcode.

** எச்சரிக்கை **: உங்கள் தளம் ஒரு*பீகல்போன்*மற்றும் நிறுவல் படிகளை நீங்கள் சரியாகப் பின்பற்றினால், லினக்ச் எம்.சி.யு ஏற்கனவே நிறுவப்பட்டு உங்கள் கணினிக்காக கட்டமைக்கப்பட்டுள்ளது.

## ஆர்.சி ச்கிரிப்டை நிறுவவும்

நீங்கள் இரண்டாம் நிலை MCU ஆக ஓச்டைப் பயன்படுத்த விரும்பினால், கிளிப்பர்_எம்சியூ செயல்முறை கிளிப்பி செயல்முறைக்கு முன் இயங்க வேண்டும்.

கிளிப்பரை நிறுவிய பிறகு, ச்கிரிப்டை நிறுவவும். ரன்:

```
குறுவட்டு ~/கிளிப்பர்/
 sudo cp.
 sudo systemctl klipper-mcu.service ஐ இயக்கவும்
```

## மைக்ரோ-கன்ட்ரோலர் குறியீட்டை உருவாக்குதல்

கிளிப்பர் மைக்ரோ-கன்ட்ரோலர் குறியீட்டை தொகுக்க, அதை "லினக்ச் செயல்முறை" க்கு உள்ளமைப்பதன் மூலம் தொடங்கவும்:

```
cd ~/klipper/
make menuconfig
```

பட்டியலில், "மைக்ரோகண்ட்ரோலர் கட்டிடக்கலை" ஐ "லினக்ச் செயல்முறை" என அமைக்கவும், பின்னர் சேமித்து வெளியேறவும்.

புதிய மைக்ரோ-கண்ட்ரோலர் குறியீட்டை உருவாக்க மற்றும் நிறுவ, இயக்கவும்:

```
sudo service klipper stop
make flash
sudo service klipper start
```

`/Tmp/klipper_host_mcu` உடன் இணைக்க முயற்சிக்கும்போது" இசைவு மறுக்கப்பட்டது "பிழையைப் புகாரளித்தால், உங்கள் பயனரை TTY குழுவில் சேர்க்க வேண்டும். பின்வரும் கட்டளை "பை" பயனரை TTY குழுவில் சேர்க்கும்:

```
sudo usermod -a -g tty pi
```

## Remaining configuration

[ராச்பெர்ரிய்பிஐ மாதிரி கட்டமைப்பு] (../ config/மாதிரி-ராச்பெர்ரி-பிஐ.சிஎஃப்சி) மற்றும் [மல்டி எம்.சி.யு மாதிரி கட்டமைப்பு] (../ உள்ளமைவு/மாதிரி-மல்டி-எம்.சி.யு ஆகியவற்றில் உள்ள வழிமுறைகளைப் பின்பற்றி கிளிப்பர் இரண்டாம் நிலை எம்.சி.யுவை உள்ளமைப்பதன் மூலம் நிறுவலை முடிக்கவும். சி.எஃப்.சி).

## விரும்பினால்: SPI ஐ இயக்குகிறது

Make sure the Linux SPI driver is enabled by running `sudo raspi-config` and enabling SPI under the "Interfacing options" menu.

## விரும்பினால்: I2C ஐ இயக்குகிறது

`சூடோ ராச்பி-கான்ஃபிக்` ஐ இயக்குவதன் மூலமும்," இடைமுக விருப்பங்கள் "மெனுவின் கீழ் I2C ஐ இயக்குவதன் மூலமும் லினக்ச் I2C இயக்கி இயக்கப்பட்டிருப்பதை உறுதிசெய்க. MPU முடுக்கமானிக்கு I2C ஐப் பயன்படுத்தத் திட்டமிட்டால், பாட் வீதத்தை 400000 ஆக அமைக்க வேண்டும்: `dtparam = i2c_arm = on, i2c_arm_baudrate = 400000` இல்`/boot/config.txt` (அல்லது `/ சில டிச்ட்ரோக்களில் துவக்க/நிலைபொருள்/config.txt`).

## விரும்பினால்: சரியான GPIOCHIP ஐ அடையாளம் காணவும்

ராச்பெர்ரி பை மற்றும் பல குளோன்களில் GPIO இல் வெளிப்படுத்தப்பட்ட ஊசிகளும் முதல் GPIOCHIP க்கு சொந்தமானவை. எனவே அவற்றை `gpio0..n` என்ற பெயருடன் குறிப்பிடுவதன் மூலம் கிளிப்பரில் பயன்படுத்தலாம். இருப்பினும், அம்பலப்படுத்தப்பட்ட ஊசிகளும் முதல் gpiochips க்கு சொந்தமான வழக்குகள் உள்ளன. உதாரணமாக சில ஆரஞ்ச்பி மாதிரிகள் அல்லது ஒரு துறைமுக விரிவாக்கம் பயன்படுத்தப்பட்டால். இந்த சந்தர்ப்பங்களில், உள்ளமைவை சரிபார்க்க * லினக்ச் சி.பி.ஐ.ஓ எழுத்து சாதனத்தை * அணுக கட்டளைகளைப் பயன்படுத்துவது பயனுள்ளதாக இருக்கும்.

ஆக்டோபி ரன் போன்ற டெபியன் அடிப்படையிலான டிச்ட்ரோவில் * லினக்ச் சி.பி.ஐ.ஓ எழுத்து சாதனத்தை நிறுவ: பைனரி *:

```
sudo apt-get install gpiod
```

கிடைக்கக்கூடிய GPIOCHIP ரன் சரிபார்க்க:

```
gpiodetect
```

முள் எண் மற்றும் முள் கிடைக்கும் டன் சரிபார்க்க:

```
gpioinfo
```

தேர்ந்தெடுக்கப்பட்ட முள் உள்ளமைவுக்குள் `gpiochip <n>/gpio <o>` எங்கே ** n ** என்பது சிப் எண் `gpiodetect` கட்டளை மற்றும் ** o ** வரி எண் `Gpioinfo` கட்டளையால் பார்த்தது.

*** எச்சரிக்கை: *** `பயன்படுத்தப்படாத` எனக் குறிக்கப்பட்ட GPIO மட்டுமே பயன்படுத்தப்படலாம். ஒரே நேரத்தில் பல செயல்முறைகளால் ஒரு * வரி * பயன்படுத்த முடியாது.

எடுத்துக்காட்டாக, ஒரு RPI 3B+ இல் கிளிப்பர் ஒரு சுவிட்சுக்கு GPIO20 ஐப் பயன்படுத்துகிறது:

```
$ gpiodetect
 gpiochip0 [pinctrl-bcm2835] (54 கோடுகள்)
 gpiochip1 [raspberrypi-exp-gpio] (8 கோடுகள்)

 $ gpioinfo
 gpiochip0 - 54 கோடுகள்:
 வரி 0: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 1: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 2: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 3: பெயரிடப்படாத உள்ளீடு செயலில்-உயர்
 வரி 4: பெயரிடப்படாத உள்ளீடு செயலில்-உயர்
 வரி 5: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 6: பெயரிடப்படாத உள்ளீடு செயலில்-உயர்
 வரி 7: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 8: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 9: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 10: பெயரிடப்படாத உள்ளீடு செயலில்-உயர்
 வரி 11: பெயரிடப்படாத உள்ளீடு செயலில்-உயர்
 வரி 12: பெயரிடப்படாத உள்ளீடு செயலில்-உயர்
 வரி 13: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 14: பெயரிடப்படாத உள்ளீடு செயலில்-உயர்
 வரி 15: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 16: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 17: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 18: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 19: பெயரிடப்படாத உள்ளீடு செயலில்-உயர்
 வரி 20: பெயரிடப்படாத "கிளிப்பர்" வெளியீடு செயலில்-உயர் [பயன்படுத்தப்பட்டது]
 வரி 21: பெயரிடப்படாத உள்ளீடு செயலில்-உயர்
 வரி 22: பெயரிடப்படாத உள்ளீடு செயலில்-உயர்
 வரி 23: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 24: பெயரிடப்படாத உள்ளீடு செயலில்-உயர்
 வரி 25: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 26: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 27: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 28: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 29: பெயரிடப்படாத "LED0" வெளியீடு செயலில்-உயர் [பயன்படுத்தப்பட்டது]
 வரி 30: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 31: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 32: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 33: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 34: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 35: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 36: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 37: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 38: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 39: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 40: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 41: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 42: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 43: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 44: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 45: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 46: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 47: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 48: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 49: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 50: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 51: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 52: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 53: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 gpiochip1 - 8 கோடுகள்:
 வரி 0: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 1: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 2: பெயரிடப்படாத "லெட் 1" வெளியீடு செயலில்-குறைந்த [பயன்படுத்தப்பட்டது]
 வரி 3: பெயரிடப்படாத உள்ளீடு செயலில்-உயர்
 வரி 4: பெயரிடப்படாத உள்ளீடு செயலில்-உயர்
 வரி 5: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
 வரி 6: பெயரிடப்படாத உள்ளீடு செயலில்-உயர்
 வரி 7: பெயரிடப்படாத பயன்படுத்தப்படாத உள்ளீடு செயலில்-உயர்
```

## விரும்பினால்: வன்பொருள் PWM

ராச்பெர்ரி பைக்களில் இரண்டு பி.டபிள்யூ.எம் சேனல்கள் (பி.டபிள்யூ.எம் 0 மற்றும் பி.டபிள்யூ.எம் 1) உள்ளன, அவை தலைப்பில் அம்பலப்படுத்தப்படுகின்றன அல்லது இல்லையென்றால், இருக்கும் சி.பி.ஐ.ஓ ஊசிகளுக்கு அனுப்பப்படலாம். லினக்ச் ஓச்ட்களில் வன்பொருள் PWM சாதனங்களைக் கட்டுப்படுத்த லினக்ச் MCU டீமான் PWMCHIP SYSFS இடைமுகத்தைப் பயன்படுத்துகிறது. PWM SYSFS இடைமுகம் இயல்புநிலையாக ஒரு ராச்பெர்ரியில் அம்பலப்படுத்தப்படவில்லை, மேலும் `/boot/config.txt` க்கு ஒரு வரியைச் சேர்ப்பதன் மூலம் செயல்படுத்தப்படலாம்:

```
# PWMCHIP SYSFS இடைமுகத்தை இயக்கவும்
 dtoverlay = pwm, முள் = 12, func = 4
```

இந்த எடுத்துக்காட்டு PWM0 ஐ மட்டுமே செயல்படுத்துகிறது மற்றும் அதை GPIO12 க்கு வழிநடத்துகிறது. இரண்டு PWM சேனல்களையும் இயக்க வேண்டும் என்றால், நீங்கள் `PWM-2Chan` ஐப் பயன்படுத்தலாம்:

```
# PWMCHIP SYSFS இடைமுகத்தை இயக்கவும்
 dtoverlay = pwm-2chan, முள் = 12, func = 4, pin2 = 13, func2 = 4
```

இந்த எடுத்துக்காட்டு கூடுதலாக PWM1 ஐ செயல்படுத்துகிறது மற்றும் அதை GPIO13 க்கு வழிநடத்துகிறது.

மேலடுக்கு துவக்கத்தில் SYSF களில் PWM வரியை அம்பலப்படுத்தாது, மேலும் PWM சேனலின் எண்ணிக்கையை `/sys/class/pwm/pwmchip0/export` க்கு எதிரொலிப்பதன் மூலம் ஏற்றுமதி செய்ய வேண்டும். இது கோப்பு முறைமையில் சாதனம் `/sys/class/pwm/pwmchip0/pwm0` ஐ உருவாக்கும். இதைச் செய்வதற்கான எளிதான வழி, `/etc/rc.local` இல்` வெளியேறு 0` வரிக்கு முன் சேர்ப்பதன் மூலம்:

```
# PWMCHIP SYSFS இடைமுகத்தை இயக்கவும்
 எதிரொலி 0>/sys/class/pwm/pwmchip0/ஏற்றுமதி
```

இரண்டு PWM சேனல்களையும் பயன்படுத்தும் போது, இரண்டாவது சேனலின் எண்ணிக்கையும் எதிரொலிக்க வேண்டும்:

```
# PWMCHIP SYSFS இடைமுகத்தை இயக்கவும்
 எதிரொலி 0>/sys/class/pwm/pwmchip0/ஏற்றுமதி
 எதிரொலி 1>/sys/class/pwm/pwmchip0/ஏற்றுமதி
```

SYSF கள் இடத்தில், உங்கள் `printel.cfg` இல் பின்வரும் உள்ளமைவைச் சேர்ப்பதன் மூலம் இப்போது PWM சேனலை (கள்) பயன்படுத்தலாம்:

```
[output_pin caselight]
 முள்: ஓச்ட்: PWMCHIP0/PWM0
 பி.டபிள்யூ.எம்: உண்மை
 வன்பொருள்_ப்வபிள்யூஎம்: உண்மை
 சைக்கிள்_ நேரம்: 0.000001

 [output_pin பீப்பர்]
 முள்: ஓச்ட்: PWMCHIP0/PWM1
 பி.டபிள்யூ.எம்: உண்மை
 வன்பொருள்_ப்வபிள்யூஎம்: உண்மை
 மதிப்பு: 0
 பணிநிறுத்தம்_ மதிப்பு: 0
 சுழற்சி_ நேரம்: 0.0005
```

இது PI இல் GPIO12 மற்றும் GPIO13 க்கு வன்பொருள் PWM கட்டுப்பாட்டைச் சேர்க்கும் (ஏனெனில் மேலடுக்கு PWM0 க்கு முள் = 12 மற்றும் PWM1 க்கு முள் = 13 வரை கட்டமைக்கப்பட்டது).

PWM0 ஐ GPIO12 மற்றும் GPIO18 க்கு அனுப்பலாம், PWM1 ஐ GPIO13 மற்றும் GPIO19 க்கு அனுப்பலாம்:

| பி.டபிள்யூ.எம் | GPIO முள் | FUNC |
| --- | --- | --- |
| 0 | 12 | 4 |
| 0 | 18 | 2 |
| 1 | 13 | 4 |
| 1 | 19 | 2 |
