# SDCARD புதுப்பிப்புகள்

இன்றைய பிரபலமான கட்டுப்பாட்டு பலகைகள் பல எச்டி அட்டை வழியாக ஃபார்ம்வேரைப் புதுப்பிக்கும் திறன் கொண்ட துவக்க ஏற்றி கொண்டவை. பல சூழ்நிலைகளில் இது வசதியானது என்றாலும், இந்த துவக்க ஏற்றிகள் பொதுவாக ஃபார்ம்வேரைப் புதுப்பிக்க வேறு வழியில்லை. உங்கள் பலகை அணுக கடினமாக இருக்கும் இடத்தில் ஏற்றப்பட்டிருந்தால் அல்லது நீங்கள் அடிக்கடி ஃபார்ம்வேரை புதுப்பிக்க வேண்டுமானால் இது ஒரு தொல்லையாக இருக்கலாம். கிளிப்பர் ஆரம்பத்தில் ஒரு கட்டுப்படுத்திக்கு பறந்த பிறகு, புதிய ஃபார்ம்வேரை எச்டி கார்டுக்கு மாற்றவும், பாஓடு வழியாக ஒளிரும் நடைமுறையைத் தொடங்கவும் முடியும்.

## வழக்கமான மேம்படுத்தல் செயல்முறை

எச்டி கார்டைப் பயன்படுத்தி எம்.சி.யு ஃபார்ம்வேரைப் புதுப்பிப்பதற்கான செயல்முறை மற்ற முறைகளுக்கு ஒத்ததாகும். `மேக் ஃப்ளாச்` ஐப் பயன்படுத்துவதற்குப் பதிலாக, உதவி ச்கிரிப்டை இயக்குவது அவசியம்,` ஃப்ளாச்-Sdcard.sh`. ஒரு பிக் ட்ரீட்டெக் எச்.கே.ஆர் 1.3 ஐ புதுப்பிப்பது பின்வருவனவற்றைப் போல் இருக்கலாம்:

```
சூடோ பணி கிளிப்பர் நிறுத்தம்
 சிடி ~/கிளிப்பர்
 அறிவிலி இழுத்தல்
 சுத்தமாக செய்யுங்கள்
 மெனுகான்ஃபிக் செய்யுங்கள்
 உருவாக்கு
 ./scripts/flash-sdcard.sh /dev/ttyACM0 btt-skr-v1.3
 சூடோ பணி கிளிப்பர் தொடக்க
```

சாதன இருப்பிடம் மற்றும் போர்டு பெயரை தீர்மானிக்க வேண்டியது பயனரின் பொறுப்பாகும். ஒரு பயனர் பல பலகைகளை ஒளிரச் செய்ய வேண்டுமானால், கிளிப்பர் சேவையை மறுதொடக்கம் செய்வதற்கு முன்னர் ஒவ்வொரு போர்டுக்கும் `ஃப்ளாச்-Sdcard.sh` (அல்லது` பொருத்தமாக இருந்தால் `ஃப்ளாச் செய்யுங்கள்) இயக்கப்பட வேண்டும்.

ஆதரிக்கப்பட்ட பலகைகளை பின்வரும் கட்டளையுடன் பட்டியலிடலாம்:

```
./scripts/flash-sdcard.sh -l
```

உங்கள் வாரியம் பட்டியலிடப்பட்டதை நீங்கள் காணவில்லை என்றால், [கீழே விவரிக்கப்பட்டுள்ள] (#போர்டு-வரையறைகள்) புதிய போர்டு வரையறையைச் சேர்க்க வேண்டியது தேவை.

## மேம்பட்ட பயன்பாடு

மேலே உள்ள கட்டளைகள் உங்கள் எம்.சி.யு இயல்புநிலை பாட் விகிதத்தில் 250000 மற்றும் ஃபார்ம்வேர் `~/klipper/out/klipper.bin` இல் அமைந்துள்ளது என்று கருதுகின்றன. `Flash-sdcard.sh` ச்கிரிப்ட் இந்த இயல்புநிலைகளை மாற்றுவதற்கான விருப்பங்களை வழங்குகிறது. அனைத்து விருப்பங்களையும் உதவித் திரை மூலம் பார்க்கலாம்:

```
./scripts/flash-sdcard.sh -h
 எச்டி அட்டை கிளிப்பருக்கான பயன்பாடு பதிவேற்றும் பயன்பாடு

 பயன்பாடு: flash_sdcard.sh [-h] [-l] [-c] [-b <baud>] [-f <firmware>]
 <device> <board>

 நிலை வாதங்கள்:
 <சாதனம்> சாதன சீரியல் துறைமுகம்
 <board> பலகை வகை

 விருப்ப வாதங்கள்:
 -h இந்த செய்தியைக் காட்டுங்கள்
 -எல் பட்டியல் கிடைக்கும் பலகைகள்
 -c ரன் ஃப்ளாச் சோதனை/சரிபார்க்கவும் (பதிவேற்றத்தைத் தவிர்க்கவும்)
 -B <பாட்> சீரியல் பாட் வீதம் (இயல்புநிலை 250000)
 -f <firmware> klipper.bin க்கு பாதை
```

தனிப்பயன் பாட் விகிதத்தில் இணைக்கும் ஃபார்ம்வேருடன் உங்கள் பலகை ஒளிரும் என்றால், `-B` விருப்பத்தைக் குறிப்பிடுவதன் மூலம் மேம்படுத்த முடியும்:

```
./scripts/flash-sdcard.sh -b 115200 /dev/ttyAMA0 btt-skr-v1.3
```

இயல்புநிலை இருப்பிடத்தைத் தவிர வேறு எங்காவது அமைந்துள்ள கிளிப்பரை உருவாக்க நீங்கள் விரும்பினால், `-f` விருப்பத்தைக் குறிப்பிடுவதன் மூலம் அதைச் செய்யலாம்:

```
./scripts/flash-sdcard.sh -f ~/downloads/cliffs.bin/dev/ttyama0 BTT-SR-V1.3
```

ஒரு எம்.கே.எச் ராபின் இ 3 ஐ மேம்படுத்தும் போது `Update_mks_robin.py` ஐ கைமுறையாக இயக்கவும், இதன் விளைவாக வரும் பைனரி` ஃப்ளாச்-Sdcard.sh` க்கு வழங்கவும் தேவையில்லை என்பதை நினைவில் கொள்க. பதிவேற்றும் செயல்பாட்டின் போது இந்த செயல்முறை தானியங்கி செய்யப்படுகிறது.

குறிப்பிட்ட ஃபார்ம்வேரை சரியாக இயக்குகிறதா என்பதை சோதிக்க காசோலை அல்லது சரிபார்க்க மட்டுமே செயல்பாட்டுக்கு `-c` விருப்பம் பயன்படுத்தப்படுகிறது. இந்த விருப்பம் முதன்மையாக ஒளிரும் நடைமுறையை முடிக்க ஒரு கையேடு சக்தி-சுழற்சி தேவையான நிகழ்வுகளுக்கு நோக்கமாக உள்ளது, அதாவது தங்கள் எச்டி கார்டுகளை அணுக SPI க்கு பதிலாக SDIO பயன்முறையைப் பயன்படுத்தும் துவக்க ஏற்றிகள் போன்றவை. .

## எச்சரிக்கைகள்

- அறிமுகத்தில் குறிப்பிட்டுள்ளபடி, இந்த முறை ஃபார்ம்வேரை மேம்படுத்த மட்டுமே வேலை செய்கிறது. உங்கள் கட்டுப்பாட்டு வாரியத்திற்கு பொருந்தும் வழிமுறைகளுக்குள் ஆரம்ப ஒளிரும் செயல்முறை கைமுறையாக செய்யப்பட வேண்டும்.
- சீரியல் பாட் அல்லது இணைப்பு இடைமுகத்தை (அதாவது: யூ.எச்.பி முதல் யுஆர்டி வரை) மாற்றும் ஒரு கட்டமைப்பை ஒளிரச் செய்ய முடியும் என்றாலும், தற்போதைய பதிப்பை சரிபார்க்க ச்கிரிப்ட் எம்.சி.யுவுடன் மீண்டும் இணைக்க முடியாததால் சரிபார்ப்பு எப்போதும் தோல்வியடையும்.
- எச்டி அட்டை தகவல்தொடர்புக்கு SPI ஐப் பயன்படுத்தும் பலகைகள் மட்டுமே ஆதரிக்கப்படுகின்றன. ஃப்ளைமேக்கர் ஃப்ளைபோர்டு மற்றும் எம்.கே.எச் ராபின் நானோ வி 1/வி 2 போன்ற SDIO ஐப் பயன்படுத்தும் பலகைகள் SDIO பயன்முறையில் வேலை செய்யாது. இருப்பினும், அதற்கு பதிலாக மென்பொருள் SPI பயன்முறையைப் பயன்படுத்தி இதுபோன்ற பலகைகளை ஒளிரச் செய்வது சாத்தியமாகும். எச்டி கார்டை அணுக போர்டின் துவக்க ஏற்றி SDIO பயன்முறையை மட்டுமே பயன்படுத்தினால், போர்டு மற்றும் எச்டி கார்டின் ஆற்றல் சுழற்சி அவசியமாக இருக்கும், இதனால் பயன்முறை SDIO க்கு மீண்டும் SDIO க்கு மாற முடியும். இத்தகைய பலகைகள் ஒளிரும் உடனேயே சரிபார்க்கும் படிநிலையைத் தவிர்க்க `Skip_verify` உடன் வரையறுக்கப்பட வேண்டும். கையேடு சக்தி-சுழற்சிக்குப் பிறகு, நீங்கள் அதே `/ச்கிரிப்டுகள்/ஃப்ளாச்-Sdcard.sh` கட்டளையை மீண்டும் இயக்கலாம், ஆனால் காசோலை/சரிபார்க்க செயல்பாட்டை முடிக்க` -c` விருப்பத்தைச் சேர்க்கவும். எடுத்துக்காட்டுகளுக்கு [SDIO ஐப் பயன்படுத்தும் ஒளிரும் பலகைகள்] (#ஒளிரும்-போர்டுகள்-அந்த பயன்பாட்டு-Sdio) ஐப் பார்க்கவும்.

## போர்டு வரையறைகள்

பெரும்பாலான பொதுவான பலகைகள் கிடைக்க வேண்டும், இருப்பினும் தேவைப்பட்டால் புதிய போர்டு வரையறையைச் சேர்க்க முடியும். போர்டு வரையறைகள் `~/klipper/scripts/spi_flash/board_defs.py` இல் அமைந்துள்ளன. வரையறைகள் அகராதியில் சேமிக்கப்படுகின்றன, எடுத்துக்காட்டாக:

```python
Board_defs = {
 'generic-lpc1768': {
 'MCU': "LPC1768",
 'SPI_BUS': "SSP1",
 "CS_PIN": "P0.6"
 },
 ... <மேலும் வரையறைகள்>
 }
```

பின்வரும் புலங்கள் குறிப்பிடப்படலாம்:

- `MCU`: MCU வகை. `பூனை .கான்பிக் | grep config_mcu`. இந்த புலம் தேவை.
- `SPI_BUS`: SD கார்டுடன் இணைக்கப்பட்ட SPI பச். வாரியத்தின் திட்டத்திலிருந்து இதை மீட்டெடுக்க வேண்டும். இந்த புலம் தேவை.
- `CS_PIN`: SD கார்டுடன் இணைக்கப்பட்ட CIP ஐத் தேர்ந்தெடுக்கவும். இதை வாரியத் திட்டத்திலிருந்து மீட்டெடுக்க வேண்டும். இந்த புலம் தேவை.
- `ஃபார்ம்வேர்_பாத்`: ஃபார்ம்வேர் மாற்றப்பட வேண்டிய எச்டி கார்டில் உள்ள பாதை. இயல்புநிலை `firmware.bin`.
- `Current_firmware_path`: வெற்றிகரமான ஃபிளாச் பிறகு மறுபெயரிடப்பட்ட ஃபார்ம்வேர் கோப்பு அமைந்துள்ள எச்டி கார்டில் உள்ள பாதை. இயல்புநிலை `firmware.cur`.
- `Skip_verify`: இது ஒரு பூலியன் மதிப்பை வரையறுக்கிறது, இது ஒளிரும் செயல்பாட்டின் போது ஃபார்ம்வேர் சரிபார்ப்பு படியைத் தவிர்க்க ச்கிரிப்ட்களைச் சொல்கிறது. இயல்புநிலை `பொய்`. ஒளிரும் முடிக்க ஒரு கையேடு ஆற்றல் சுழற்சி தேவைப்படும் பலகைகளுக்கு இது `உண்மை` என அமைக்கப்படலாம். பின்னர் ஃபார்ம்வேரை சரிபார்க்க, சரிபார்ப்பு படி செய்ய `-c` விருப்பத்துடன் ச்கிரிப்டை மீண்டும் இயக்கவும். [SDIO அட்டைகளுடன் எச்சரிக்கைகள் காண்க] (#எச்சரிக்கைகள்)

மென்பொருள் SPI தேவைப்பட்டால், `SPI_BUS` புலம்` SWSPI` ஆக அமைக்கப்பட வேண்டும், மேலும் பின்வரும் கூடுதல் புலம் குறிப்பிடப்பட வேண்டும்:

- `SPI_PINS`: இது` மிசோ, மொசி, ச்க்ல்க்` வடிவத்தில் எச்டி கார்டுடன் இணைக்கப்பட்டுள்ள 3 கமாவைப் பிரித்த ஊசிகளாக இருக்க வேண்டும்.

மென்பொருள் SPI தேவை என்பது மிகவும் அரிதாக இருக்க வேண்டும், பொதுவாக வடிவமைப்பு பிழைகள் அல்லது பலகைகள் கொண்ட பலகைகள் மட்டுமே தங்கள் SD கார்டுக்கு SDIO பயன்முறையை மட்டுமே ஆதரிக்கும். `BTT-SKR-PRO` போர்டு வரையறை முந்தையவற்றின் உதாரணத்தை வழங்குகிறது, மேலும்` BTT-OCTOPUS-F446-V1` போர்டு வரையறை பிந்தையவருக்கு ஒரு எடுத்துக்காட்டு வழங்குகிறது.

புதிய போர்டு வரையறையை உருவாக்குவதற்கு முன், புதிய வாரியத்திற்குத் தேவையான அளவுகோல்களை ஏற்கனவே உள்ள வாரிய வரையறை நிறைவு செய்கிறதா என்பதை ஒருவர் சரிபார்க்க வேண்டும். இதுபோன்றால், ஒரு `போர்டு_லியாச்` குறிப்பிடப்படலாம். எடுத்துக்காட்டாக, `பொதுவான-எல்.பி.சி 1768` க்கான மாற்றுப்பெயராக` எனது புதிய போர்டு` குறிப்பிட பின்வரும் மாற்றுப்பெயர் சேர்க்கப்படலாம்:

```python
Board_aliases = {
 ... <முந்தைய மாற்றுப்பெயர்கள்>,
 'என்-புதிய-பலகை': போர்டு_டெஃப்ச் ['பொதுவான-எல்பிசி 1768'],
 }
```

உங்களுக்கு ஒரு புதிய போர்டு வரையறை தேவைப்பட்டால், மேலே குறிப்பிட்டுள்ள நடைமுறையில் உங்களுக்கு சங்கடமாக இருந்தால், [கிளிப்பர் சமூக டிச்கார்ட்] (தொடர்பு. எம்.டி#முரண்பாடு) இல் ஒன்றை நீங்கள் கோர பரிந்துரைக்கப்படுகிறது.

## SDIO ஐப் பயன்படுத்தும் ஒளிரும் பலகைகள்

. எச்டி கார்டுக்கான கோப்பு துவக்க ஏற்றி பலகையில் ஒளிரும். இந்த போர்டு வரையறைகள் `SKIP_VERIFY` கொடியைப் பயன்படுத்தும், இது எச்டி கார்டுக்கு ஃபார்ம்வேரை எழுதிய பிறகு நிறுத்தும்படி ஒளிரும் கருவியைக் கூறுகிறது, இதனால் வாரியத்தை கைமுறையாக சக்தி-சைக்கிள் ஓட்டவும், அது முடியும் வரை சரிபார்ப்பு படி ஒத்திவைக்கப்படலாம்.

இரண்டு காட்சிகள் உள்ளன - ஒன்று ஆர்.பி.ஐ புரவலன் ஒரு தனி மின்சக்தியில் இயங்குகிறது, மற்றொன்று முதன்மையான வாரியம் ஒளிரும் அதே மின்சார விநியோகத்தில் ஆர்.பி.ஐ புரவலன் இயங்கும்போது. சரிபார்ப்பு படிநிலையைச் செய்வதற்காக ஒளிரும் முடிந்ததும், அல்லது சரிபார்ப்பை உடனடியாக செய்ய முடியுமா என்பதையும் `Ssh` மீண்டும்` Ssh` க்கும் அவசியமா இல்லையா என்பதுதான் வேறுபாடு. இரண்டு காட்சிகளின் எடுத்துக்காட்டுகள் இங்கே:

### தனி மின்சாரம் குறித்து RPI உடன் SDIO நிரலாக்க

ஒரு தனி மின்சக்தியில் RPI உடன் ஒரு பொதுவான அமர்வு பின்வருவது போல் தெரிகிறது. நிச்சயமாக, நீங்கள் உங்கள் சரியான சாதன பாதை மற்றும் போர்டு பெயரைப் பயன்படுத்த வேண்டும்:

```
சூடோ பணி கிளிப்பர் நிறுத்தம்
 சிடி ~/கிளிப்பர்
 அறிவிலி இழுத்தல்
 சுத்தமாக செய்யுங்கள்
 மெனுகான்ஃபிக் செய்யுங்கள்
 உருவாக்கு
 ./scripts/flash-sdcard.sh /dev/ttyACM0 btt-octopus-f446-v1
 [[[அறிவுறுத்தப்பட்டபோது இங்கே அச்சுப்பொறி பலகையை கைமுறையாக பவர்-சுழற்சி]]]
 ./scripts/flash-sdcard.sh -c /dev/ttyACM0 btt-octopus-f446-v1
 சூடோ பணி கிளிப்பர் தொடக்க
```

### அதே மின்சாரம் குறித்து RPI உடன் SDIO நிரலாக்க

அதே மின்சார விநியோகத்தில் RPI உடன் ஒரு பொதுவான அமர்வு பின்வருவது போல் தெரிகிறது. நிச்சயமாக, நீங்கள் உங்கள் சரியான சாதன பாதை மற்றும் போர்டு பெயரைப் பயன்படுத்த வேண்டும்:

```
சூடோ பணி கிளிப்பர் நிறுத்தம்
 சிடி ~/கிளிப்பர்
 அறிவிலி இழுத்தல்
 சுத்தமாக செய்யுங்கள்
 மெனுகான்ஃபிக் செய்யுங்கள்
 உருவாக்கு
 ./scripts/flash-sdcard.sh /dev/ttyACM0 btt-octopus-f446-v1
 sudo shutown -h இப்போது
 [[ஆர்.பி.ஐ பணிநிறுத்தம் செய்ய காத்திருங்கள், பின்னர் பவர்-சைக்கிள் மற்றும் எச்.எச்.எச் மீண்டும் ஆர்.பி.ஐ மறுதொடக்கம் செய்யும்போது]]]]]
 சூடோ பணி கிளிப்பர் நிறுத்தம்
 சிடி ~/கிளிப்பர்
 ./scripts/flash-sdcard.sh -c /dev/ttyACM0 btt-octopus-f446-v1
 சூடோ பணி கிளிப்பர் தொடக்க
```

இந்த வழக்கில், RPI புரவலன் மறுதொடக்கம் செய்யப்படுவதால், இது `கிளிப்பர்` சேவையை மறுதொடக்கம் செய்யும் என்பதால், சரிபார்ப்பு படிநிலையைச் செய்வதற்கு முன்` கிளிப்பர்` மீண்டும் நிறுத்த வேண்டியது தேவை, சரிபார்ப்பு முடிந்ததும் அதை மறுதொடக்கம் செய்யுங்கள்.

### Sdio பெறுநர் spi முள் மேப்பிங்

உங்கள் வாரியத்தின் திட்டம் அதன் எச்டி கார்டுக்கு SDIO ஐப் பயன்படுத்தினால், `board_defs.py` கோப்பில் ஒதுக்க இணக்கமான மென்பொருள் SPI ஊசிகளைத் தீர்மானிக்க கீழேயுள்ள விளக்கப்படத்தில் விவரிக்கப்பட்டுள்ளபடி ஊசிகளை வரைபடமாக்கலாம்:

| எச்டி அட்டை முள் | மைக்ரோ எச்டி அட்டை முள் | Sdio முள் பெயர் | SPI முள் பெயர் |
| :-: | :-: | :-: | :-: |
| 9 | 1 | தரவு | எதுவுமில்லை (பு)* |
| 1 | 2 | குறுவட்டு/தேதி 3 | CS |
| 2 | 3 | சி.எம்.டி. | மொசி |
| 4 | 4 | +3.3 வி (வி.டி.டி) | +3.3 வி (வி.டி.டி) |
| 5 | 5 | Clk | Sclk |
| 3 | 6 | சி.என்.டி (வி.எச்.எச்) | சி.என்.டி (வி.எச்.எச்) |
| 7 | 7 | தேதி 0 | மிசோ |
| 8 | 8 | தரவு 1 | எதுவுமில்லை (பு)* |
| N/A | 9 | அட்டை கண்டறிதல் (குறுவட்டு) | அட்டை கண்டறிதல் (குறுவட்டு) |
| 6 | 10 | GND | GND |

\* எதுவுமில்லை (PU) புல்-அப் மின்தடையுடன் பயன்படுத்தப்படாத முள் குறிக்கிறது
