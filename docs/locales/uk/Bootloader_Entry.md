# Запис завантажувача

Klipper можна наказати перезавантажити [Bootloader](Bootloaders.md) одним із таких способів:

## Запит на завантаження

### Віртуальний серій

Якщо у віртуальному (USB-ACM) серійний порт знаходиться у використанні, пульсує DTR, при цьому на 1200 baud буде вимагати завантаження.

#### Python (з `flash_usb`)

Щоб ввести завантажувач за допомогою python (напр. `flash_usb`):

```shell
> cd klipper/scripts
> python3 -c "import flash_usb як u; u.enter_bootloader("<DEVICE>") Р
Вхід завантажувача на <DEVICE>
```

Де `<DEVICE>` є вашим серійним пристроєм, наприклад ` /dev/serial.by-id/usb-Klipper[...]` або ` /dev/ttyACM0`

Зауважте, що якщо це не вдалося, не буде друкувати, успіх вказується друком `Встановлює завантаження на <DEVICE>`.

#### Пікоком

```shell
pico com -b 1200 <DEVICE>
<Ctrl-A><Ctrl-P>
```

Де `<DEVICE>` є вашим серійним пристроєм, наприклад ` /dev/serial.by-id/usb-Klipper[...]` або ` /dev/ttyACM0`

`<Ctrl-A><Ctrl-P>` означає проведення `Ctrl`, пресування та випуск `a`, пресування та випуск `p`, потім випуск `Ctrl`

### Фізична послідовність

Якщо на MCU використовується фізичний серійний порт (навіть, якщо USB серійний адаптер використовується для підключення до нього), відправивши рядок `<SPACE><FS><SPACE><SPACE>Запит серійного завантаження!<SPACE>~`.

`<SPACE>` - ASCII літровий простір, 0x20.

`<FS>` - Сепаратор файлів ASCII, 0x1c.

Зауважте, що це недійсне повідомлення відповідно до [протоколу MCU](Protocol.md#micro-controller-interface), але символи синхронізації (`~`) все ще поважаються.

Оскільки це повідомлення має бути єдиною річ в "блокі" він отримується, префіксуючи додатковий символ синхронізації може збільшити надійність, якщо інші інструменти були раніше доступ до серійного порту.

#### Шпалери

```shell
<a href="http://realtor.if.ua/" title="Агентство нерухомості Ріелтор"></a>
Echo $' ~ \x1c Запит Серійний Bootloader! ~' >> /dev/<DEVICE>
```

Де `<DEVICE>` - ваш серійний порт, наприклад `/dev/ttyS0`, або `/dev/serial/by-id/gpio-serial2`, і

`<BAUD>` є курсом серійного порту, наприклад `115200`.

### КАНБУС

Якщо CANBUS є у використанні, спеціальне [адміністрування повідомлення](CANBUS_protocol.md#admin-messages) вимагатиме завантаження. Це повідомлення буде поважати навіть якщо пристрій вже має вузол, а також буде оброблятися, якщо mcu вимкнено.

Цей метод відноситься до пристроїв, що працюють в режимі [CANBridge](CANBUS.md#usb-to-can-bus-bridge-mode).

#### Флеш-інструмент Katapult. пісяють

```shell
python 3 ./katapult/scripts/flashtool.py -i <CAN_IFACE> -u <UUID> -r
```

Де `<CAN_IFACE>` є інтерфейсом для використання. Якщо ви використовуєте `can0`, як `-i` і `<CAN_IFACE>` може бути підключений.

`<UID>` є UUID вашого пристрою CAN.

Дивитися [CANBUS Документація](CANBUS.md#finding-the-canbus_uid-for-new-micro-controllers) для отримання інформації про пошук CAN UUID ваших пристроїв.

## Введіть завантажувач

Коли klipper отримує одне з вищезазначених запитів завантажувача:

Якщо Katapult (колишній відомий як CANBoot) доступний, klipper запитує, що Katapult залишається активним на наступному завантаженні, після чого скидати MCU (для входу в Katapult).

Якщо Katapult не доступний, klipper потім намагатиметься ввести платформу-специфічний завантажувач, такі як режим DFU STM32 ([див. замітка](#stm32-dfu-warning)).

Коротко, Klipper перезавантажить до Katapult, якщо встановлено, то апаратний конкретний завантажувач, якщо це можливо.

Деталі про конкретні завантажувачі на різних платформах див. [Bootloaders](Bootloaders. мд)

## Ноти

### СТМ32 ДФУ Зареєструватися

Зверніть увагу, що на деяких дошках, таких як Octopus Pro v1, введення режиму DFU може викликати небажані дії (наприклад, живлення нагрівача в режимі DFU). Рекомендується відключати нагрівачі, а іншим чином запобігти небажаним операціям при використанні режиму DFU. Консультування документації для отримання більш детальної інформації.
