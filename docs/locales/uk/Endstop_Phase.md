# Положення кінцевика

Цей документ описує фазу крокової залози Klipper, що регулюється ендостопною системою. Цей функціонал може підвищити точність традиційних торцевих вимикачів. Найкорисніший при використанні драйвера двигуна Trinamic stepper, який має конфігурацію часу.

Типовий перемикач торцевого струму має точність близько 100 мкм. (Для цього часу вісь додається перемикач може викликати трохи раніше або трохи пізніше.) Хоча це відносно невелика помилка, вона може призвести до небажаних артефактів. Зокрема, це положення може бути помітним при друку першого шару об'єкта. На відміну від типових крокових двигунів можна отримати значно вищу точність.

Механізм крокової фази регулюється торцевим механізмом може використовувати точність крокових двигунів для поліпшення точності торцевих перемикачів. кроковий двигун рухається на велосипеді через ряд фази до завершення чотирьох "повних кроків". Таким чином, кроковий двигун, використовуючи 16 мікрокроступів, буде мати 64 фази і при переході в позитивному напрямку, він буде циклуватися через фази: 0, 1, 2, ... 61, 62, 63, 0, 1, 2 і т.д. Таким чином, коли кроковий двигун знаходиться на певній позиції на лінійній рейці, він завжди повинен бути на тій же стадії крокової фази. Таким чином, при перевезенні торцевого перемикача кроковий контроль, що перевезення завжди повинна бути на тій же крокової моторної фази. Фаза Klipper's endstop поєднує в собі фазу крокової залози з торцевим тригером для поліпшення точності торцевої поверхні.

Для використання даної функціональності необхідно визначити фазу крокової двигуна. Якщо ви використовуєте Trinamic TMC2130, TMC2208, TMC2224 або TMC2660 драйверів в режимі налаштування часу (тобто, не автономний режим), то Klipper може переробити крокову фазу від драйвера. (Так само можна використовувати цю систему на традиційних Драйверах, якщо можна надійно скидати Драйвери - див. нижче для деталей.)

## Калібруючі фази торцевих стоків

Якщо за допомогою Trinamic stepper моторних драйверів з конфігурацією run-time, то можна калібрувати фази завершення за допомогою ENDSTOP_ Команда PHASE_CALIBRATE. Почати, додавши наступний файл налаштування:

```
[ендстоп_фаза]
```

Потім RESTART принтер і запустіть команду `G28` за допомогою `ENDSTOP_PHASE_CALIBRATE`. Потім перемістіть на панелі інструментів нове місце і запустіть `G28` знову. Спробуйте перемістити інструментголово на кілька різних локаціях і перебігу `G28` з кожного положення. Запуск принаймні п'ять `G28` команди.

Після виконання вищевказаного, `ENDSTOP_PHASE_CALIBRATE` команда часто звітує одну і ту саму (або майже однакову) фазу для кроку. Ця фаза може бути збережена в файлі конфігурації, щоб всі майбутні команди G28 використовують цю фазу. (Так, у майбутніх операціях, Klipper отримає однакову позицію, навіть якщо торцевий спровокує трохи раніше або трохи пізніше.)

Щоб зберегти торцеву фазу для конкретного крокового двигуна, запустіть щось на зразок:

```
УКРПОШТА СТЕППЕР=Степпер_з
```

Виконайте вище для всіх кроків, щоб зберегти. Зазвичай, можна використовувати це на stepper_z для картоперіанських і ядрових принтерів, і для stepper_a, stepper_b і stepper_c на принтерах delta. Нарешті, запустіть наступне оновлення файлу конфігурації з даними:

```
ПРОКСИМУС
```

### Додаткові ноти

* Ця функція є найбільш корисною для принтерів delta і на Z endstop of cartesian/corexy. Ви можете використовувати цю функцію на XY endstops of cartesian принтерів, але це не особливо корисно як незначна помилка в положенні X / Y навряд чи впливає на якість друку. Не діє використовувати цю функцію на торцевих поверхнях XY (як позиція XY не визначена одним кроком на кінематиці ядра). Не діє використовувати цю функцію на принтері за допомогою "probe:z_virtual_endstop" Z endstop (як кроковий фаза є тільки стабільним, якщо торець знаходиться на статичному місці на рейки).
* Після калібрування торцевої фази, якщо торець пізніше переміщається або регулюється, то потрібно буде перерахувати торець. Видаліть дані калібрування з конфігураційного файлу та перейміть дії вище.
* Для того, щоб використовувати цю систему, торцева поверхня повинна бути досить точною, щоб визначити позицію кроквя в межах двох "повних кроків". Так, наприклад, якщо степпер використовується 16 мікрокроступів з покроковою дистанцією 0.005мм, після чого стілець повинен мати точність принаймні 0,160мм. Якщо один отримує "Endstop stepper_z невірної фази" повідомлення про помилку типу, ніж у може бути пов'язано з кінцевою поверхнею, яка не є достатньо точним. Якщо рекалібрація не допомагає потім відключати налаштування фазових торрентів, видалівши їх з конфігураційного файлу.
* Якщо ви використовуєте традиційну крокову вісь Z (як на візках, так і на струменевій принтері) разом з традиційними вирівнюючими гвинтами, то також можна використовувати цю систему, щоб влаштовувати для кожного шару друку, щоб виконати на межі "повний крок". Щоб увімкнути цю функцію, обов'язково налаштовується скибочка G-Code з висотою шару, яка являє собою декілька "повний крок", вручну увімкніть параметр endstop_align_zero в розділі endstop_phase config (див. [Налаштування посилання](Config_Reference.md#endstop_phase) для подальших деталей), а потім перерівняти гвинти.
* Можливе використання цієї системи з традиційними (нетринамічними) кроковими двигунами. Тим не менш, це вимагає того, що крокові двигуни скидають кожен раз, коли мікроконтролер скидається. (Якщо два завжди скидаються разом, то Klipper може визначити фазу крокової залози, відстежуючи загальну кількість кроків, які він замовив stepper для переміщення.) В даний час єдиний спосіб зробити це надійно, якщо як мікроконтролер, так і кроковий двигун драйверів працює виключно з USB і що живлення USB забезпечується від господаря, що працює на Raspberry Pi. У цій ситуації можна вказати на конфігурацію mcu з "restart_method: rpi_usb" - що варіант буде влаштовувати для мікроконтролера, щоб завжди бути скиданням живлення USB, який буде влаштовувати як для мікроконтролерів, так і для водіїв крокових двигунів, які будуть скидати разом. Якщо ви використовуєте цей механізм, то потрібно вручну налаштувати розділи "trigger_phase" (див. [посилання на налаштування](Config_Reference.md#endstop_phase) для деталей).
