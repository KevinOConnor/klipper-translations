
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../img/favicon.ico">
      <meta name="generator" content="mkdocs-1.2.4, mkdocs-material-8.1.3">
    
    
      
        <title>Протокол - Klipper documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.edf004c2.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.e6a45f82.min.css">
        
      
    
    
    
      
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../_klipper3d/css/extra.css">
    
    <script>__md_scope=new URL("../..",location),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","G-VEN1PGNQL4"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&gtag("event","search",{search_term:this.value})}),"undefined"!=typeof location$&&location$.subscribe(function(e){gtag("config","G-VEN1PGNQL4",{page_path:e.pathname})})})</script>
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-VEN1PGNQL4"></script>


    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="blue">
  
    
    
      <script>var palette=__md_get("__palette");if(palette&&"object"==typeof palette.color)for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)</script>
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#_1" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="Klipper documentation" class="md-header__button md-logo" aria-label="Klipper documentation" data-md-component="logo">
      
  <img src="../../img/klipper.svg" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            Klipper documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Протокол
            
          </span>
        </div>
      </div>
    </div>
    
      <form class="md-header__option" data-md-component="palette">
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="white" data-md-color-accent="blue"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_1">
          
            <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_2" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 0-7 7c0 2.38 1.19 4.47 3 5.74V17a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1v-2.26c1.81-1.27 3-3.36 3-5.74a7 7 0 0 0-7-7M9 21a1 1 0 0 0 1 1h4a1 1 0 0 0 1-1v-1H9v1z"/></svg>
            </label>
          
        
          
          
          <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="grey" data-md-color-accent="light-blue"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_2">
          
            <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_1" hidden>
              <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 2a7 7 0 0 1 7 7c0 2.38-1.19 4.47-3 5.74V17a1 1 0 0 1-1 1H9a1 1 0 0 1-1-1v-2.26C6.19 13.47 5 11.38 5 9a7 7 0 0 1 7-7M9 21v-1h6v1a1 1 0 0 1-1 1h-4a1 1 0 0 1-1-1m3-17a5 5 0 0 0-5 5c0 2.05 1.23 3.81 3 4.58V16h4v-2.42c1.77-.77 3-2.53 3-4.58a5 5 0 0 0-5-5z"/></svg>
            </label>
          
        
      </form>
    
    
      <div class="md-header__option">
        <div class="md-select">
          
          <button class="md-header__button md-icon" aria-label="Select language">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M16.36 14c.08-.66.14-1.32.14-2 0-.68-.06-1.34-.14-2h3.38c.16.64.26 1.31.26 2s-.1 1.36-.26 2m-5.15 5.56c.6-1.11 1.06-2.31 1.38-3.56h2.95a8.03 8.03 0 0 1-4.33 3.56M14.34 14H9.66c-.1-.66-.16-1.32-.16-2 0-.68.06-1.35.16-2h4.68c.09.65.16 1.32.16 2 0 .68-.07 1.34-.16 2M12 19.96c-.83-1.2-1.5-2.53-1.91-3.96h3.82c-.41 1.43-1.08 2.76-1.91 3.96M8 8H5.08A7.923 7.923 0 0 1 9.4 4.44C8.8 5.55 8.35 6.75 8 8m-2.92 8H8c.35 1.25.8 2.45 1.4 3.56A8.008 8.008 0 0 1 5.08 16m-.82-2C4.1 13.36 4 12.69 4 12s.1-1.36.26-2h3.38c-.08.66-.14 1.32-.14 2 0 .68.06 1.34.14 2M12 4.03c.83 1.2 1.5 2.54 1.91 3.97h-3.82c.41-1.43 1.08-2.77 1.91-3.97M18.92 8h-2.95a15.65 15.65 0 0 0-1.38-3.56c1.84.63 3.37 1.9 4.33 3.56M12 2C6.47 2 2 6.5 2 12a10 10 0 0 0 10 10 10 10 0 0 0 10-10A10 10 0 0 0 12 2z"/></svg>
          </button>
          <div class="md-select__inner">
            <ul class="md-select__list">
              
                <li class="md-select__item">
                  <a href="/" hreflang="en" class="md-select__link">
                    English
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/zh/" hreflang="zh" class="md-select__link">
                    简体中文
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/zh-Hant/" hreflang="zh-Hant" class="md-select__link">
                    繁體中文
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/hu/" hreflang="hu" class="md-select__link">
                    Magyar
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/it/" hreflang="it" class="md-select__link">
                    Italiano
                  </a>
                </li>
                
                <li class="md-select__item">
                  <a href="/fr/" hreflang="fr" class="md-select__link">
                    Français
                  </a>
                </li>
                
            </ul>
          </div>
        </div>
      </div>
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7 0-.24-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91 1.61 0 2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08z"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/Klipper3d/klipper/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Klipper3d/klipper
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="Klipper documentation" class="md-nav__button md-logo" aria-label="Klipper documentation" data-md-component="logo">
      
  <img src="../../img/klipper.svg" alt="logo">

    </a>
    Klipper documentation
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/Klipper3d/klipper/" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    Klipper3d/klipper
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Overview.html" class="md-nav__link">
        Overview
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Features.html" class="md-nav__link">
        Features
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../FAQ.html" class="md-nav__link">
        Frequently Asked Questions
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Releases.html" class="md-nav__link">
        Releases
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Config_Changes.html" class="md-nav__link">
        Configuration Changes
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Contact.html" class="md-nav__link">
        Contact
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7" type="checkbox" id="__nav_7" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7">
          Installation and Configuration
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Installation and Configuration" data-md-level="1">
        <label class="md-nav__title" for="__nav_7">
          <span class="md-nav__icon md-icon"></span>
          Installation and Configuration
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_1" type="checkbox" id="__nav_7_1" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_1">
          Installation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Installation" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_1">
          <span class="md-nav__icon md-icon"></span>
          Installation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Installation.html" class="md-nav__link">
        Installation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../OctoPrint.html" class="md-nav__link">
        OctoPrint for Klipper
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_2" type="checkbox" id="__nav_7_2" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_2">
          Configuration Reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Configuration Reference" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_2">
          <span class="md-nav__icon md-icon"></span>
          Configuration Reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Config_Reference.html" class="md-nav__link">
        Configuration reference
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Rotation_Distance.html" class="md-nav__link">
        Rotation distance
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Config_checks.html" class="md-nav__link">
        Configuration checks
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_4" type="checkbox" id="__nav_7_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_4">
          Bed Level
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Bed Level" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_4">
          <span class="md-nav__icon md-icon"></span>
          Bed Level
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Bed_Level.html" class="md-nav__link">
        Bed leveling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Delta_Calibrate.html" class="md-nav__link">
        Delta calibration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Probe_Calibrate.html" class="md-nav__link">
        Probe calibration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../BLTouch.html" class="md-nav__link">
        BL-Touch
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Manual_Level.html" class="md-nav__link">
        Manual leveling
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Bed_Mesh.html" class="md-nav__link">
        Bed Mesh
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Endstop_Phase.html" class="md-nav__link">
        Endstop phase
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Axis_Twist_Compensation.html" class="md-nav__link">
        Axis Twist Compensation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_5" type="checkbox" id="__nav_7_5" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_5">
          Resonance Compensation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Resonance Compensation" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_5">
          <span class="md-nav__icon md-icon"></span>
          Resonance Compensation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Resonance_Compensation.html" class="md-nav__link">
        Resonance Compensation
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Measuring_Resonances.html" class="md-nav__link">
        Measuring Resonances
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Pressure_Advance.html" class="md-nav__link">
        Pressure advance
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../G-Codes.html" class="md-nav__link">
        G-Codes
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_7_8" type="checkbox" id="__nav_7_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_7_8">
          Command templates
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Command templates" data-md-level="2">
        <label class="md-nav__title" for="__nav_7_8">
          <span class="md-nav__icon md-icon"></span>
          Command templates
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Command_Templates.html" class="md-nav__link">
        Commands templates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Status_Reference.html" class="md-nav__link">
        Status reference
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../TMC_Drivers.html" class="md-nav__link">
        TMC drivers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Multi_MCU_Homing.html" class="md-nav__link">
        Multiple Micro-controller Homing and Probing
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Slicers.html" class="md-nav__link">
        Slicers
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Skew_Correction.html" class="md-nav__link">
        Skew correction
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Exclude_Object.html" class="md-nav__link">
        Exclude Objects
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Using_PWM_Tools.html" class="md-nav__link">
        Using PWM tools
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_8" type="checkbox" id="__nav_8" >
      
      
      
      
        <label class="md-nav__link" for="__nav_8">
          Developer Documentation
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Developer Documentation" data-md-level="1">
        <label class="md-nav__title" for="__nav_8">
          <span class="md-nav__icon md-icon"></span>
          Developer Documentation
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Code_Overview.html" class="md-nav__link">
        Code overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Kinematics.html" class="md-nav__link">
        Kinematics
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Protocol.html" class="md-nav__link">
        Protocol
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../API_Server.html" class="md-nav__link">
        API server
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../MCU_Commands.html" class="md-nav__link">
        MCU commands
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CANBUS_protocol.html" class="md-nav__link">
        CANBUS protocol
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Debugging.html" class="md-nav__link">
        Debugging
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Benchmarks.html" class="md-nav__link">
        Benchmarks
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CONTRIBUTING.html" class="md-nav__link">
        Contributing to Klipper
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Packaging.html" class="md-nav__link">
        Packaging Klipper
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_9" type="checkbox" id="__nav_9" >
      
      
      
      
        <label class="md-nav__link" for="__nav_9">
          Device Specific Documents
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="Device Specific Documents" data-md-level="1">
        <label class="md-nav__title" for="__nav_9">
          <span class="md-nav__icon md-icon"></span>
          Device Specific Documents
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Example_Configs.html" class="md-nav__link">
        Example configurations
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../SDCard_Updates.html" class="md-nav__link">
        SDCard updates
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../RPi_microcontroller.html" class="md-nav__link">
        RPi microcontroller
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Beaglebone.html" class="md-nav__link">
        Beaglebone
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Bootloaders.html" class="md-nav__link">
        Bootloaders
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Bootloader_Entry.html" class="md-nav__link">
        Bootloader Entry
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CANBUS.html" class="md-nav__link">
        CANBUS
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CANBUS_Troubleshooting.html" class="md-nav__link">
        CANBUS Troubleshooting
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../TSL1401CL_Filament_Width_Sensor.html" class="md-nav__link">
        TSL1401CL filament width sensor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Hall_Filament_Width_Sensor.html" class="md-nav__link">
        Hall filament width sensor
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../Eddy_Probe.html" class="md-nav__link">
        Eddy Current Inductive probe
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../Sponsors.html" class="md-nav__link">
        Sponsors
      </a>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#_2" class="md-nav__link">
    Интерфейс на микроконтролера
  </a>
  
    <nav class="md-nav" aria-label="Интерфейс на микроконтролера">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_3" class="md-nav__link">
    Деклариране на команди
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_4" class="md-nav__link">
    Деклариране на отговори
  </a>
  
    <nav class="md-nav" aria-label="Деклариране на отговори">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_5" class="md-nav__link">
    Изходни отговори
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_6" class="md-nav__link">
    Деклариране на изброявания
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_7" class="md-nav__link">
    Деклариране на константи
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_8" class="md-nav__link">
    Кодиране на съобщения на ниско ниво
  </a>
  
    <nav class="md-nav" aria-label="Кодиране на съобщения на ниско ниво">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_9" class="md-nav__link">
    Блокове за съобщения
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_10" class="md-nav__link">
    Съдържание на блока от съобщения
  </a>
  
    <nav class="md-nav" aria-label="Съдържание на блока от съобщения">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#_11" class="md-nav__link">
    Количества с променлива дължина
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#_12" class="md-nav__link">
    Низове с променлива дължина
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_13" class="md-nav__link">
    Речник на данните
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#_14" class="md-nav__link">
    Поток на съобщението
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content" data-md-component="content">
            <article class="md-content__inner md-typeset">
              
                
<a href="https://github.com/Klipper3d/klipper/blob/master/docs/locales/bg/Protocol.md" title="Edit this page" class="md-content__button md-icon">
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg>
</a>


<h1 id="_1">Протокол<a class="headerlink" href="#_1" title="Permanent link">&para;</a></h1>
<p>Протоколът за съобщения на Klipper се използва за комуникация на ниско ниво между хост софтуера на Klipper и софтуера на микроконтролера Klipper. На високо ниво протоколът може да се разглежда като поредица от низове с команди и отговори, които се компресират, предават и след това се обработват от приемащата страна. Примерна поредица от команди в некомпресиран формат, удобен за четене от човека, може да изглежда така:</p>
<div class="highlight"><pre><span></span><code>set_digital_out pin=PA3 value=1
set_digital_out pin=PA7 value=1
schedule_digital_out oid=8 clock=4000000 value=0
queue_step oid=7 interval=7458 count=10 add=331
queue_step oid=7 interval=11717 count=4 add=1281
</code></pre></div>

<p>Вижте документа <a href="MCU_Commands.html">mcu commands</a> за информация относно наличните команди. Вижте документа <a href="Debugging.html">debugging</a> за информация как да преведете G-Code файл в съответните му четими за човека команди за микроконтролера.</p>
<p>Тази страница съдържа описание на високо ниво на самия протокол за обмен на съобщения Klipper. Тя описва как съобщенията се декларират, кодират в двоичен формат ("компресираща" схема) и предават.</p>
<p>Целта на протокола е да осигури безпогрешен комуникационен канал между хоста и микроконтролера, който е с ниска латентност, ниска честотна лента и ниска сложност за микроконтролера.</p>
<h2 id="_2">Интерфейс на микроконтролера<a class="headerlink" href="#_2" title="Permanent link">&para;</a></h2>
<p>Протоколът за предаване Klipper може да се разглежда като механизъм <a href="https://en.wikipedia.org/wiki/Remote_procedure_call">RPC</a> между микроконтролера и хоста. Софтуерът на микроконтролера декларира командите, които хостът може да извика, заедно със съобщенията за отговор, които може да генерира. Домакинът използва тази информация, за да командва микроконтролера да извършва действия и да интерпретира резултатите.</p>
<h3 id="_3">Деклариране на команди<a class="headerlink" href="#_3" title="Permanent link">&para;</a></h3>
<p>Софтуерът на микроконтролера декларира "команда", като използва макроса DECL_COMMAND() в кода на езика С. Например:</p>
<div class="highlight"><pre><span></span><code>DECL_COMMAND(command_update_digital_out, &quot;update_digital_out oid=%c value=%c&quot;);
</code></pre></div>

<p>Горното декларира команда с име "update_digital_out". Това позволява на хоста да "извика" тази команда, което ще доведе до изпълнение на функцията command_update_digital_out() C в микроконтролера. Горното също така показва, че командата приема два целочислени параметъра. Когато кодът command_update_digital_out() C бъде изпълнен, ще му бъде предаден масив, съдържащ тези две цели числа - първото, съответстващо на "oid", и второто, съответстващо на "value".</p>
<p>По принцип параметрите се описват със синтаксис в стил printf() (например "%u"). Форматирането пряко съответства на разбираемия за човека вид на командите (напр. "update_digital_out oid=7 value=1"). В горния пример "value=" е име на параметър, а "%c" показва, че параметърът е цяло число. Вътрешно името на параметъра се използва само като документация. В този пример "%c" се използва и като документация, за да покаже, че очакваното цяло число е с размер 1 байт (декларираният размер на цялото число не влияе на парсинга или кодирането).</p>
<p>Изграждането на микроконтролера ще събере всички команди, декларирани с DECL_COMMAND(), ще определи техните параметри и ще ги подготви за извикване.</p>
<h3 id="_4">Деклариране на отговори<a class="headerlink" href="#_4" title="Permanent link">&para;</a></h3>
<p>За да се изпрати информация от микроконтролера към хоста, се генерира "отговор". Те се декларират и предават с помощта на макроса sendf() C. Например:</p>
<div class="highlight"><pre><span></span><code>sendf(&quot;status clock=%u status=%c&quot;, sched_read_time(), sched_is_shutdown());
</code></pre></div>

<p>В горния случай се предава съобщение за отговор "статус", което съдържа два целочислени параметъра ("clock" и "status"). Изграждането на микроконтролера автоматично открива всички sendf() повиквания и генерира енкодери за тях. Първият параметър на функцията sendf() описва отговора и е в същия формат като декларациите на командите.</p>
<p>Домакинът може да регистрира функция за обратно извикване за всеки отговор. Така на практика командите позволяват на хоста да извиква C функции в микроконтролера, а отговорите позволяват на софтуера на микроконтролера да извиква код в хоста.</p>
<p>Макросът sendf() трябва да се извиква само от обработчици на команди или задачи и не трябва да се извиква от прекъсвачи или таймери. Не е необходимо кодът да издава sendf() в отговор на получена команда, той не е ограничен в броя на случаите, в които може да бъде извикан sendf(), и може да извика sendf() по всяко време от обработчик на задачи.</p>
<h4 id="_5">Изходни отговори<a class="headerlink" href="#_5" title="Permanent link">&para;</a></h4>
<p>За да се улесни отстраняването на грешки, има и функция output() C. Например:</p>
<div class="highlight"><pre><span></span><code>output(&quot;The value of %u is %s with size %u.&quot;, x, buf, buf_len);
</code></pre></div>

<p>Функцията output() е подобна на printf() - тя е предназначена за генериране и форматиране на произволни съобщения за човешка употреба.</p>
<h3 id="_6">Деклариране на изброявания<a class="headerlink" href="#_6" title="Permanent link">&para;</a></h3>
<p>Изброяването позволява на кода на хоста да използва символни низове за параметри, които микроконтролерът обработва като цели числа. Те се декларират в кода на микроконтролера - например:</p>
<div class="highlight"><pre><span></span><code>DECL_ENUMERATION(&quot;spi_bus&quot;, &quot;spi&quot;, 0);

DECL_ENUMERATION_RANGE(&quot;pin&quot;, &quot;PC0&quot;, 16, 8);
</code></pre></div>

<p>В първия пример макросът DECL_ENUMERATION() дефинира изброяване за всяко съобщение за команда/отговор с име на параметър "spi_bus" или име на параметър със суфикс "_spi_bus". За тези параметри низът "spi" е валидна стойност и тя ще бъде предадена с цяло число, равно на нула.</p>
<p>Възможно е също така да декларирате обхват на изброяване. Във втория пример параметърът "pin" (или всеки параметър със суфикс "_pin") ще приема като валидни стойности PC0, PC1, PC2, ..., PC7. Низовете ще се предават с цели числа 16, 17, 18, ..., 23.</p>
<h3 id="_7">Деклариране на константи<a class="headerlink" href="#_7" title="Permanent link">&para;</a></h3>
<p>Константите също могат да бъдат експортирани. Например, следното:</p>
<div class="highlight"><pre><span></span><code>DECL_CONSTANT(&quot;SERIAL_BAUD&quot;, 250000);
</code></pre></div>

<p>ще експортира константа с име "SERIAL_BAUD" със стойност 250000 от микроконтролера към хоста. Възможно е също така да декларирате константа, която представлява низ - например:</p>
<div class="highlight"><pre><span></span><code>DECL_CONSTANT_STR(&quot;MCU&quot;, &quot;pru&quot;);
</code></pre></div>

<h2 id="_8">Кодиране на съобщения на ниско ниво<a class="headerlink" href="#_8" title="Permanent link">&para;</a></h2>
<p>За да се осъществи горепосоченият механизъм RPC, всяка команда и отговор се кодират в двоичен формат за предаване. Този раздел описва системата за предаване.</p>
<h3 id="_9">Блокове за съобщения<a class="headerlink" href="#_9" title="Permanent link">&para;</a></h3>
<p>Всички данни, изпращани от хоста към микроконтролера и обратно, се съдържат в "блокове за съобщения". Блокът от съобщения има два байта заглавие и три байта трейлър. Форматът на блока от съобщения е:</p>
<div class="highlight"><pre><span></span><code>&lt;1 byte length&gt;&lt;1 byte sequence&gt;&lt;n-byte content&gt;&lt;2 byte crc&gt;&lt;1 byte sync&gt;
</code></pre></div>

<p>Байтът за дължина съдържа броя на байтовете в блока на съобщението, включително байтовете на заглавието и трейлъра (по този начин минималната дължина на съобщението е 5 байта). В момента максималната дължина на блока от съобщения е 64 байта. Байтът на последователността съдържа 4-битов номер на последователността в ниските битове, а високите битове винаги съдържат 0x10 (високите битове са запазени за бъдеща употреба). Байтовете със съдържание съдържат произволни данни и техният формат е описан в следващия раздел. Байтовете crc съдържат 16-битов CCITT <a href="https://en.wikipedia.org/wiki/Cyclic_redundancy_check">CRC</a> на блока от съобщения, включително байтовете на заглавието, но без байтовете на ремаркето. Синхронизиращият байт е 0x7e.</p>
<p>Форматът на блока от съобщения е вдъхновен от рамките от съобщения <a href="https://en.wikipedia.org/wiki/High-Level_Data_Link_Control">HDLC</a>. Подобно на HDLC, блокът от съобщения може по желание да съдържа допълнителен синхронизиращ символ в началото на блока. За разлика от HDLC, символът за синхронизация не е изключителен за рамкирането и може да присъства в съдържанието на блока от съобщения.</p>
<h3 id="_10">Съдържание на блока от съобщения<a class="headerlink" href="#_10" title="Permanent link">&para;</a></h3>
<p>Всеки блок от съобщения, изпратен от хоста към микроконтролера, съдържа поредица от нула или повече команди за съобщения. Всяка команда започва с <a href="#variable-length-quantities">Variable Length Quantity</a> (VLQ) кодирано цяло число command-id, последвано от нула или повече VLQ параметри за дадената команда.</p>
<p>Например, следните четири команди могат да бъдат поставени в един блок от съобщения:</p>
<div class="highlight"><pre><span></span><code>update_digital_out oid=6 value=1
update_digital_out oid=5 value=0
get_config
get_clock
</code></pre></div>

<p>и се кодират в следните осем VLQ цели числа:</p>
<div class="highlight"><pre><span></span><code>&lt;id_update_digital_out&gt;&lt;6&gt;&lt;1&gt;&lt;id_update_digital_out&gt;&lt;5&gt;&lt;0&gt;&lt;id_get_config&gt;&lt;id_get_clock&gt;
</code></pre></div>

<p>За да се кодира и анализира съдържанието на съобщението, хостът и микроконтролерът трябва да се споразумеят за идентификаторите на командите и броя на параметрите на всяка команда. Така в горния пример и хостът, и микроконтролерът ще знаят, че "id_update_digital_out" винаги е последвана от два параметъра, а "id_get_config" и "id_get_clock" имат нула параметри. Домакинът и микроконтролерът споделят "речник на данните", който съпоставя описанията на командите (например "update_digital_out oid=%c value=%c") с техните целочислени идентификатори на командите. Когато обработва данните, анализаторът знае, че трябва да очаква определен брой VLQ кодирани параметри след даден идентификатор на команда.</p>
<p>Съдържанието на съобщенията за блоковете, изпращани от микроконтролера към хоста, следва същия формат. Идентификаторите в тези съобщения са "идентификатори на отговора", но те служат за същата цел и следват същите правила за кодиране. На практика блоковете от съобщения, изпращани от микроконтролера към хоста, никога не съдържат повече от един отговор в съдържанието на блока от съобщения.</p>
<h4 id="_11">Количества с променлива дължина<a class="headerlink" href="#_11" title="Permanent link">&para;</a></h4>
<p>Вижте статията в <a href="https://en.wikipedia.org/wiki/Variable-length_quantity">Уикипедия</a> за повече информация относно общия формат на VLQ кодираните цели числа. Klipper използва схема за кодиране, която поддържа както положителни, така и отрицателни цели числа. Цели числа, близки до нула, използват по-малко байтове за кодиране, а положителните цели числа обикновено се кодират с по-малко байтове, отколкото отрицателните цели числа. Следващата таблица показва броя на байтовете, необходими за кодиране на всяко цяло число:</p>
<table>
<thead>
<tr>
<th>Цели числа</th>
<th>Кодиран размер</th>
</tr>
</thead>
<tbody>
<tr>
<td>-32 .. 95</td>
<td>1</td>
</tr>
<tr>
<td>-4096 .. 12287</td>
<td>2</td>
</tr>
<tr>
<td>-524288 .. 1572863</td>
<td>3</td>
</tr>
<tr>
<td>-67108864 .. 201326591</td>
<td>4</td>
</tr>
<tr>
<td>-2147483648 .. 4294967295</td>
<td>5</td>
</tr>
</tbody>
</table>
<h4 id="_12">Низове с променлива дължина<a class="headerlink" href="#_12" title="Permanent link">&para;</a></h4>
<p>Като изключение от горните правила за кодиране, ако параметър на команда или отговор е динамичен низ, тогава параметърът не се кодира като просто цяло число VLQ. Вместо това той се кодира чрез предаване на дължината като VLQ кодирано цяло число, последвано от самото съдържание:</p>
<div class="highlight"><pre><span></span><code>&lt;VLQ encoded length&gt;&lt;n-byte contents&gt;
</code></pre></div>

<p>Описанията на командите, които се намират в речника на данните, позволяват на хоста и микроконтролера да разберат кои параметри на командите използват просто VLQ кодиране и кои параметри използват символно кодиране.</p>
<h2 id="_13">Речник на данните<a class="headerlink" href="#_13" title="Permanent link">&para;</a></h2>
<p>За да може да се установи смислена комуникация между микроконтролера и хоста, двете страни трябва да се споразумеят за "речник на данните". Този речник на данните съдържа целочислените идентификатори на командите и отговорите, както и техните описания.</p>
<p>Изграждането на микроконтролера използва съдържанието на макросите DECL_COMMAND() и sendf(), за да генерира речника с данни. Изграждането автоматично присвоява уникални идентификатори на всяка команда и отговор. Тази система позволява както на кода на хоста, така и на кода на микроконтролера безпроблемно да използват описателни имена, които могат да се четат от човека, като същевременно използват минимална честотна лента.</p>
<p>При първоначалното свързване с микроконтролера хостът прави запитване към речника с данни. След като хостът изтегли речника на данните от микроконтролера, той използва този речник на данните, за да кодира всички команди и да анализира всички отговори от микроконтролера. Следователно хостът трябва да работи с динамичен речник на данните. Въпреки това, за да се запази софтуерът на микроконтролера прост, микроконтролерът винаги използва своя статичен (компилиран) речник на данните.</p>
<p>В речника с данни се правят справки чрез изпращане на команди "идентификация" към микроконтролера. Микроконтролерът отговаря на всяка команда за идентификация със съобщение "identify_response". Тъй като тези две команди са необходими преди получаването на речника на данните, техните целочислени идентификатори и типове параметри са твърдо кодирани както в микроконтролера, така и в хоста. Идентификаторът на отговора "identify_response" е 0, а идентификаторът на командата "identify" е 1. Освен че имат твърдо кодирани идентификатори, командата "identify" и нейният отговор се декларират и предават по същия начин, както другите команди и отговори. Нито една друга команда или отговор не са твърдо кодирани.</p>
<p>Самият формат на предавания речник с данни е компресиран от zlib JSON низ. Процесът на изграждане на микроконтролера генерира този низ, компресира го и го съхранява в текстовата секция на флаш паметта на микроконтролера. Речникът на данните може да бъде много по-голям от максималния размер на блока за съобщения - хостът го изтегля, като изпраща множество команди за идентификация, изискващи прогресивни части от речника на данните. След като получи всички части, хостът сглобява частите, разкомпресира данните и анализира съдържанието.</p>
<p>В допълнение към информацията за комуникационния протокол, речникът на данните съдържа и версията на софтуера, изброявания (както са дефинирани от DECL_ENUMERATION) и константи (както са дефинирани от DECL_CONSTANT).</p>
<h2 id="_14">Поток на съобщението<a class="headerlink" href="#_14" title="Permanent link">&para;</a></h2>
<p>Командите за съобщения, изпращани от хоста към микроконтролера, са предназначени да бъдат без грешки. Микроконтролерът проверява CRC и поредните номера във всеки блок от съобщения, за да гарантира, че командите са точни и подредени. Микроконтролерът винаги обработва блоковете със съобщения в правилен ред - ако получи блок с нарушен ред, той ще го изхвърли, както и всички други блокове с нарушен ред, докато не получи блокове с правилна последователност.</p>
<p>Кодът на ниско ниво на хоста имплементира система за автоматично препредаване на изгубени и повредени блокове от съобщения, изпратени към микроконтролера. За да се улесни това, микроконтролерът предава "блок със съобщение за потвърждение" след всеки успешно получен блок със съобщение. Домакинът планира времетраене след изпращането на всеки блок и ще препредава, ако времетраенето изтече, без да получи съответното "ack". Освен това, ако микроконтролерът открие повреден или неподреден блок, той може да предаде "nak message block", за да улесни бързото повторно предаване.</p>
<p>"Ack" е блок от съобщения с празно съдържание (т.е. блок от 5 байта) и номер на последователността, по-голям от последния получен номер на последователността на хоста. "Nak" е блок от съобщения с празно съдържание и номер на последователността, по-малък от последния получен номер на последователността на хоста.</p>
<p>Протоколът улеснява системата за предаване на "прозорци", така че хостът може да разполага с много неизпратени блокове от съобщения в движение в даден момент. (Това е в допълнение към многото команди, които могат да се съдържат в даден блок от съобщения.) Това позволява максимално използване на честотната лента дори в случай на забавяне на предаването. Механизмите за прекъсване на времето, препредаване, прозорци и потвърждение са вдъхновени от подобни механизми в <a href="https://en.wikipedia.org/wiki/Transmission_Control_Protocol">TCP</a>.</p>
<p>В другата посока блоковете със съобщения, изпращани от микроконтролера към хоста, са проектирани така, че да не допускат грешки, но нямат гарантирано предаване. (Отговорите не трябва да са повредени, но могат да липсват.) Това е направено, за да се запази реализацията в микроконтролера проста. Няма автоматична система за препредаване на отговорите - очаква се кодът на високо ниво да може да се справя със случайни липсващи отговори (обикновено чрез повторно поискване на съдържанието или създаване на повтарящ се график за предаване на отговорите). Полето за пореден номер в блоковете от съобщения, изпращани към хоста, винаги е с единица по-голямо от последния получен пореден номер на блоковете от съобщения, получени от хоста. То не се използва за проследяване на последователността на блоковете със съобщения за отговор.</p>

              
            </article>
          </div>
        </div>
        
          <a href="#" class="md-top md-icon" data-md-component="top" data-md-state="hidden">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M13 20h-2V8l-5.5 5.5-1.42-1.42L12 4.16l7.92 7.92-1.42 1.42L13 8v12z"/></svg>
            Back to top
          </a>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    <script id="__config" type="application/json">{"base": "../..", "features": ["navigation.top", "search.suggest", "search.highlight", "search.share"], "translations": {"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing", "select.version.title": "Select version"}, "search": "../../assets/javascripts/workers/search.0bbba5b5.min.js"}</script>
    
    
      <script src="../../assets/javascripts/bundle.e1a181d9.min.js"></script>
      
    
  </body>
</html>